/*!
Eson Date input control
first create by 'UANV,ESONCalendar and so on'
modify by anlige @ www.thinkasp.cn
last modify at 2015-10-26
*/
(function(){var i=0;var t=function(B,A){B=B||(new Date());A=A.replace(/(yyyy|mmmm|mmm|mm|dddd|ddd|fff|ff|f|dd|hh|ss|m|d|h|s)/ig,function(C){switch(C){case"yyyy":return B.getFullYear();case"M":return B.getMonth()+1;case"MM":return u(B.getMonth()+1);case"d":return B.getDate();case"dd":return u(B.getDate());case"H":return B.getHours();case"HH":return u(B.getHours());case"h":return B.getHours()%12;case"hh":return u(B.getHours()%12);case"m":return B.getMinutes();case"mm":return u(B.getMinutes());case"s":return B.getSeconds();case"ss":return u(B.getSeconds());default:return C}});return A};function u(A){return("0"+A).slice(-2)}function x(B,A){for(var C in A){if(A.hasOwnProperty(C)){B[C]=A[C]}}return B}function q(B,A){for(var C in B){if(!A.hasOwnProperty(C)){A[C]=B[C]}}return A}function z(D,F,C,B,A){var E=document.createElement(D.toUpperCase());F&&(E.id=F);B&&(E.className=B);A&&(E.innerHTML=A);C||(C=document.body);return C.appendChild(E)}function g(A,C,D){var B=new Date(A);B.setDate(C);return B.getDay()+(D||0)}function w(D){var E=D.getFullYear(),A=D.getMonth()+1,C=31;var B=(E%4==0&&E%4!=100||E%100==0&&E%400==0);if(/-4|-6|-9|-11/.test("-"+A)){C=30}if(A==2){C=B?29:28}return C}function d(B,D,F,E){var C;F=F||(B-11);if(F<0){F=0}s(D,"");C=z("a",null,D,false,"&lt;&lt;&lt;");for(var A=F;A<F+23;A++){C=z("a",null,D,A==B?"hover":"",A)}C=z("a",null,D,false,"&gt;&gt;&gt;");D.onclick=function(J){var I=(event.srcElement||J.target);if(I&&I.tagName){var G=I.tagName.toLowerCase(),H;if(G=="a"){H=s(I);if(H=="&lt;&lt;&lt;"){d(B,D,F-23,E)}else{if(H=="&gt;&gt;&gt;"){d(B,D,F+23,E)}else{E(H);D.parentNode.style.display="none"}}}}}}function b(D,C,E){var B="<div>";for(var A=1;A<=12;A++){B+="<a"+(A==D?' class="hover"':"")+">"+A+"</a>"}s(C,B+"</div>");C.onclick=function(I){var H=(event.srcElement||I.target);if(H&&H.tagName){var F=H.tagName.toLowerCase(),G;if(F=="a"){G=s(H);E(null,G);C.parentNode.style.display="none"}}}}function v(E,G,A,F,D){s(E,"");var C="<div>";for(var B=F||0;B<=A;B++){if((A==59&&B%5==0)||A==23||D===true){C+="<a"+(B==G?' class="hover"':"")+">"+B+"</a>"}}s(E,C+"</div>")}function s(B,A){if(A===true){return parseInt(B.innerHTML)}if(A!==undefined){B.innerHTML=A}return B.innerHTML}function p(ah,B,V,ae){var T=0,L=B.cell_height||0,Z=0;if(B.width){Z=Math.floor(B.width/7);T=Z*7;B.cell_width=Z}var ai="";var ac=z("div",null,ah,"calendar-main inline-block"),A=null,U=null;if(T>0){ac.style.width=T+"px"}if(B.has_container!==true){A=z("div",null,ac,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>')}var O=z("div",null,ac,"calendar-header");var K=z("div",null,ac,"calendar-quick");var E=z("div",null,K,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');var S=z("div",null,K,"calendar-quick-contents");var af=z("div",null,K,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');var aa=z("ul",null,O,"select-box");var F=z("li",null,aa,"area-left");var Q=z("li",null,aa,"area-middle");var I=z("li",null,aa,"area-right");var G=z("li",null,aa,"area-left area-month");var N=z("li",null,aa,"area-middle-month");var ab=z("li",null,aa,"area-right");K.style.display="none";function Y(ak,aj,am,al){E.style.display=ak;E.style.marginLeft=am;af.style.display=aj;af.style.marginLeft=al}F.onclick=function(){var aj=s(Q,true);if(aj<=0){return}s(Q,aj-1);if(K.style.display!="none"){d(s(Q,true),S,null,V)}V()};I.onclick=function(){s(Q,s(Q,true)+1);if(K.style.display!="none"){d(s(Q,true),S,null,V)}V()};Q.onclick=function(){if(ai!="year"||K.style.display=="none"){d(s(Q,true),S,null,V);K.style.display="block";ai="year";K.style.marginTop="2px";K.className="calendar-quick";Y("block","none",(Q.offsetLeft+13)+"px","0")}else{K.style.display="none"}};G.onclick=function(){var aj=s(N,true);if(aj==1){s(N,12);s(Q,s(Q,true)-1)}else{s(N,aj-1)}if(K.style.display!="none"){b(s(N,true),S,V)}V()};ab.onclick=function(){var aj=s(N,true);if(aj==12){s(N,1);s(Q,s(Q,true)+1)}else{s(N,aj+1)}if(K.style.display!="none"){b(s(N,true),S,V)}V()};N.onclick=function(){if(ai!="month"||K.style.display=="none"){b(s(N,true),S,V);K.style.display="block";ai="month";K.style.marginTop="2px";K.className="calendar-quick";Y("block","none",(N.offsetLeft+5)+"px","0")}else{K.style.display="none"}};var R=z("div",null,ac,"calendar-body-wapper");var ad=z("ul",null,R,"calendar-body"),C;for(var X=0;X<7;X++){C=z("li",false,ad,"weeks",B.weeks[X%7]);if(Z>0){C.style.width=Z+"px"}}if(B.show_time===true){var P=z("div",null,R,"calendar-time",'<div class="calendar-hours">23</div>:<div class="calendar-minutes">10</div>:<div class="calendar-seconds">12</div>'),W,ag,D;var J=P.getElementsByTagName("div"),M,H;for(var X=0;X<J.length;X++){M=J[X];H=M.className;if(H=="calendar-hours"){W=M}else{if(H=="calendar-minutes"){ag=M}else{if(H=="calendar-seconds"){D=M}}}}P.onclick=function(ap){var ao=ap?ap.target:event.srcElement,an=ao.className,ak=0,aq;if(an=="calendar-hours"){aq=s(ao,true);ak=23;S.onclick=function(au){var ar=au?au.target:event.srcElement;if(ar&&ar.tagName){var at=ar.tagName.toLowerCase();if(at=="a"){s(W,s(ar));S.parentNode.style.display="none";ae()}}};Y("none","block","0",(W.offsetLeft+11)+"px")}else{if(an=="calendar-minutes"||an=="calendar-seconds"){aq=s(ao,true);ak=59;function am(au){var at=au?au.target:event.srcElement;if(at&&at.tagName){var ar=at.tagName.toLowerCase();if(ar=="a"){if(s(at)=="&lt;&lt;&lt;"){v(S,aq,59);S.onclick=aj;K.style.marginTop=(ad.offsetHeight-K.offsetHeight)+"px"}else{if(an=="calendar-minutes"){s(ag,s(at))}else{if(an=="calendar-seconds"){s(D,s(at))}}K.style.display="none";ae()}}}}function aj(au){var at=au?au.target:event.srcElement;if(at&&at.tagName){var ar=at.tagName.toLowerCase();if(ar=="a"){var av=s(at,true);v(S,aq,av+4,av,true);z("a",null,S.getElementsByTagName("div")[0],null,"&lt;&lt;&lt;");K.style.marginTop=(ad.offsetHeight-K.offsetHeight)+"px";S.onclick=am}}}S.onclick=aj;var al=(ag.offsetLeft+11)+"px";if(an=="calendar-seconds"){al=(D.offsetLeft+11)+"px"}Y("none","block","0",al)}}if(ak>0){if(ai!=an||K.style.display=="none"){ai=an;s(S,"");v(S,aq,ak);K.style.display="block";K.className="calendar-quick calendar-quick-time";K.style.marginTop=(ad.offsetHeight-K.offsetHeight)+"px"}else{K.style.display="none"}}}}if(B.has_container!==true){U=z("div",null,R,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>')}return{last_year:F,year:Q,next_year:I,last_month:G,month:N,next_month:ab,weeks:ad,main:ac,header:O,quick:K,quick_content:S,time:{hours:function(aj){return s(W,aj)},minutes:function(aj){return s(ag,aj)},seconds:function(aj){return s(D,aj)}},arraw_down:U,arraw_up:A}}function r(B){var A={x:B.offsetLeft,y:B.offsetTop,width:B.offsetWidth,height:B.offsetHeight};B=B.offsetParent;while(B){A.x+=B.offsetLeft;A.y+=B.offsetTop;B=B.offsetParent}return A}function o(D,C){D.main.style.display="block";var E=r(C),B=E.y+E.height,A=E.x;D.arraw_up.style.display="block";D.arraw_down.style.display="none";if(B+D.main.offsetHeight>m()+c()){B=E.y-D.main.offsetHeight-5;D.arraw_up.style.display="none";D.arraw_down.style.display="block"}else{B+=5}D.main.style.cssText="position:absolute; top:"+B+"px; left:"+A+"px;"}function m(){if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}if(window.innerWidth){return window.innerHeight}if(document.body&&document.body.clientWidth){return document.body.clientHeight}return 0}function c(){if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}return(window.pageYOffset||document.body.scrollTop)||0}function y(D,C){var B=[],A=2;if(typeof D=="function"){C=D;D=null;A=1}if(arguments.length>A){B=Array.prototype.slice.call(arguments,A)}return function(){C.apply(D,B)}}function l(A){if(A&&A.stopPropagation){A.stopPropagation()}else{window.event.cancelBubble=true}}function n(D,C,B,A){if(D.addEventListener){D.addEventListener(C,B,A!==true);return}if(D.attachEvent){D.attachEvent("on"+C,B);return}D["on"+C]=B}function h(B,A){var C=B.parentNode;while(C){if(C==A){return true}C=C.parentNode}return false}function k(B){if(typeof B=="string"){var C=/^(\d{4})\-(\d{1,2})\-(\d{1,2})( (\d{1,2})\:(\d{1,2})\:(\d{1,2}))?$/.exec(B);if(C){var A=new Date(parseInt(C[1]),parseInt(C[2])-1,parseInt(C[3]));if(C[4]){A.setHours(parseInt(C[5]));A.setMinutes(parseInt(C[6]));A.setSeconds(parseInt(C[7]))}B=A}else{B=new Date()}}return B}function f(C,A){var B=C.className;if(!B){B=""}C.className=(B.replace(new RegExp("\\b"+A.replace(/\-/g,"\\-")+"\\b","g"),"")+" "+A).replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function a(C,A){var B=C.className;if(!B){B=""}C.className=B.replace(new RegExp("\\b"+A.replace(/\-/g,"\\-")+"\\b","g"),"").replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function e(C,A){var B=C.className;if(!B){B=""}return(new RegExp("\\b"+A.replace(/\-/g,"\\-")+"\\b","g")).test(B)}var j=window.Eson=function(I,L,D){_index=0;L=L||{};if(L.multi===true){delete L.multi;return j.Multi(I,L)}var B=function(V){var Y=M.weeks;F.length=0;while(Y.childNodes.length>7){Y.removeChild(Y.lastChild)}for(var X=0;X<V;X++){for(var W=0;W<7;W++){F[X*7+W]=z("li",false,Y,false,"&nbsp;");if(X==V-1){f(F[X*7+W],"calendar-last-line")}}}};var K=function(X){if(C.before_render){C.before_render(X)}var V=g(X,1)-C.first_week_day;if(V<0){V=7+V}var ab=1,af=X.getFullYear(),Y=X.getMonth()+1,ae=X.getDate();s(M.year,af);s(M.month,Y);var ah=w(X)+V,ai=C.lines||Math.ceil(ah/7),ag=ai*7;B(ai);for(var Z=0;Z<ag;Z++){var aa=F[Z];aa.isInMonth=false;if(Z<V||Z>(ah-1)){f(aa,"disabled");if(Z<V){var ad=(new Date(+X));ad.setDate(Z-V+1);aa.day=ad.getDate();aa.month=Y-1}else{aa.day=Z-ah+1;aa.month=Y+1}var ac=new Date(af,aa.month-1,aa.day);if(N[t(ac,"yyyyMMdd")]){f(aa,"selected")}}else{aa.month=Y;aa.day=ab;aa.isInMonth=true;var W=g(X,ab)%7;if(W==0||W==6){f(aa,"sunday")}if(N[af+u(Y)+u(ab)]){f(aa,"selected")}aa.onmouseover=function(){if(!e(this,"current")&&!e(this,"selected")){f(this,"current")}};aa.onmouseout=function(){a(this,"current")};ab++}s(aa,"<div>"+(C.date_up?(C.date_up.call(aa,af,aa.month,aa.day)||aa.day):aa.day)+"</div>");aa.onclick=function(){M.quick.style.display="none";ae=this.day;var am=new Date(af,this.month-1,ae),ak=[am.getFullYear(),u(am.getMonth()+1),u(am.getDate())];a(this,"current");if(C.multi_select===true){if(e(this,"selected")){a(this,"selected");ak.push(_index,false)}else{f(this,"selected");ak.push(_index,true)}}else{for(var al=0;al<F.length;al++){a(F[al],"selected")}f(this,"selected");for(var aj in N){if(N.hasOwnProperty(aj)){delete N[aj]}}N[t(am,"yyyyMMdd")]=am;if(C.show_time===true){ak.push(u(M.time.hours()),u(M.time.minutes()),u(M.time.seconds()))}ak.push(_index,this);C.date=am}if(C.onselect){C.onselect.apply(am,ak)}if(C.multi_select!==true&&!this.isInMonth){return K(am)}if(C.remain!==true){M.main.style.display="none"}}}if(C.cell_width||C.cell_height){for(var Z=0;Z<F.length;Z++){if(C.cell_width){F[Z].style.width=C.cell_width+"px";F[Z].childNodes[0].style.width=(C.cell_width-4)+"px"}if(C.cell_height){F[Z].style.height=C.cell_height+"px";F[Z].childNodes[0].style.height=(C.cell_height-4)+"px"}}}if(C.after_render){C.after_render(X)}};var P=function(V,W){if(V){s(M.year,V)}if(W){s(M.month,W)}K(new Date(s(M.year,true),s(M.month,true)-1,1))};var T=function(X){var V=[];for(var W in N){if(N.hasOwnProperty(W)&&N[W]){V.push(t(N[W],C.format?C.format:"yyyy-MM-dd"))}}if(X){X.call(N,V)}else{I.value=V.join(",")}};var S=function(W){W=W||C.date;var V=[W.getFullYear(),u(W.getMonth()+1),u(W.getDate())];if(C.show_time===true){V.push(u(M.time.hours()),u(M.time.minutes()),u(M.time.seconds()))}V.push(_index);C.onselect.apply(C.date,V)};var C={date:null,weeks:"日一二三四五六",onselect:null,first_week_day:0,weeks_count:1,multi_select:false},F=[],M=null,N=D||{};for(var R in L){if(!L.hasOwnProperty(R)){continue}C[R]=L[R]}if(typeof C.weeks=="string"){C.weeks=C.weeks.split("")}"string"==typeof(I)&&(I=document.getElementById(I));if(!I){if(C.onerror){C.onerror("target element error.")}return}var U=I.tagName.toLowerCase();if(U=="input"){if(I.type!="text"){if(C.onerror){C.onerror("target element error.")}return}}if(!C.date&&I.value){C.date=I.value}if(C.multi_select===true){var E={},H=0;if(C.date){var O,Q,G;if(typeof C.date=="string"){C.date=C.date.split(",")}for(var R=0;R<C.date.length;R++){O=k(C.date[R]);Q=t(O,"yyyyMMdd");N[Q]=O;G=Q.substr(0,6);if(!E.hasOwnProperty(G)){E[G]=[];H++}E[G].push(O)}if(H>1&&C.multi!==false){C.max_count=C.max_count||0;C.set_up_months=[];for(var R in E){if(E.hasOwnProperty(R)){C.set_up_months.push(E[R][0])}}if(C.max_count>0&&H>C.max_count){H=C.max_count}C.count=H;C.multi=false;return j.Multi(I,C,N)}}else{C.date=[]}var J=C.onselect;C.onselect=function(Z,V,Y,W,X){if(X){N[Z+V+Y]=this}else{N[Z+V+Y]=null}T(J)};T(J);C.remain=true;C.date=k(C.date[0]);if(!C.date){C.date=new Date()}}else{C.date=k(C.date);if(!C.date){C.date=new Date()}N[t(C.date,"yyyyMMdd")]=C.date;if(!C.onselect){C.onselect=function(aa,Z,Y,X,V,W){I.value=C.format?t(this,C.format):(aa+"-"+Z+"-"+Y+(C.show_time===true?(" "+X+":"+V+":"+W):""))}}var A=[C.date.getFullYear(),u(C.date.getMonth()+1),u(C.date.getDate())];if(C.show_time===true){A.push(u(C.date.getHours()),u(C.date.getMinutes()),u(C.date.getSeconds()))}A.push(_index);C.onselect.apply(C.date,A)}if(U=="input"){n(document,"click",function(W){if(!M||!M.main){return}var V=(W.target||event.srcElement);if(I==V||M.main==V||h(V,M.main)){return}M.main.style.display="none"});n(I,"focus",function(V){o(M,I)});M=p(null,C,P,S);M.main.style.display="none"}else{if(U=="div"){C.remain=true;M=p(I,C,P,S)}else{n(document,"click",function(W){if(!M||!M.main){return}var V=(W.target||event.srcElement);if(M.main==V||h(V,M.main)){return}M.main.style.display="none"});n(I,"click",function(V){l(V);o(M,I)});M=p(null,C,P,S);M.main.style.display="none"}}i++;if(C.multi_select===true){n(M.weeks,"click",function(Z){var aa=(Z?Z.target:event.srcElement)||document,Y=-1,W=aa.className;if(e(aa,"weeks")){var ac=M.weeks.getElementsByTagName("li"),ab,ad,V;for(var X=0;X<ac.length;X++){if(aa==ac[X]){Y=X}else{if(Y>=0&&X%7==Y){ab=new Date(s(M.year,true),ac[X].month-1,ac[X].day);V=t(ab,"yyyyMMdd");if(N[V]){N[V]=null}else{N[V]=ab}if(ac[X].isInMonth){ad=ab}}}}if(ad){K(ad)}T(J);if(e(aa,"checked")){a(aa,"checked")}else{f(aa,"checked")}}})}if(C.set_up_date){C.date=k(C.set_up_date)||C.date}K(C.date);if(C.show_time===true){M.time.hours(C.date.getHours());M.time.minutes(C.date.getMinutes());M.time.seconds(C.date.getSeconds())}return{options:C,controls:M,date_up:K}};j.format=t;j.bind=y;j.on=n;j.cancel_bubble=l;j.child_of=h;j.Multi=function(A,D,E){function F(){var M=z("div",null,null,"calendar-group inline-block"),O,K,J;J=z("div",null,M,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');for(var L=0;L<I.count;L++){if(I.set_up_months){O=I.set_up_months[L]}j(M,q(I,{set_up_date:O||new Date(),has_container:true}),E)}if(I.show_close!==false){var N=z("div",null,M,"calendar-close","x");N.onclick=function(){M.style.display="none"}}K=z("div",null,M,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');return{main:M,arraw_up:J,arraw_down:K}}var I={date:[],onselect:null,count:2},G=null,B=[];for(var C in D){if(!D.hasOwnProperty(C)){continue}I[C]=D[C]}I.remain=true;I.lines=6;if(!I.onselect){I.onselect=function(J){A.value=J.join(",")}}"string"==typeof(A)&&(A=document.getElementById(A));if(!A){if(I.onerror){I.onerror("target element error.")}return}var H=A.tagName.toLowerCase();if(H=="input"){if(A.type!="text"){if(I.onerror){I.onerror("target element error.")}return}n(document,"click",function(K){if(!G||!G.main){return}var J=(K.target||event.srcElement);if(A==J||G.main==J||h(J,G.main)){return}G.main.style.display="none"});n(A,"focus",function(J){o(G,A)});G=F();G.main.style.display="none"}else{if(H=="div"){G=F();A.appendChild(G.main)}else{n(document,"click",function(K){if(!G||!G.main){return}var J=(K.target||event.srcElement);if(G.main==J||h(J,G.main)){return}G.main.style.display="none"});n(A,"click",function(J){l(J);o(G,A)});G=F();G.main.style.display="none"}}return{options:I,controls:G}}})();