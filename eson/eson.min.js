/*!
Eson Date input control
first create by 'UANV,ESONCalendar and so on'
modify by anlige @ www.thinkasp.cn
last modify at 2015-10-26
*/
(function(){var z=0,f=[31,28,31,30,31,30,31,31,30,31,30,31];var u=function(M,L){M=M||(new Date());L=L.replace(/(yyyy|mm|dd|hh|ss|m|d|h|s)/ig,function(N){switch(N){case"yyyy":return M.getFullYear();case"M":return M.getMonth()+1;case"MM":return I(M.getMonth()+1);case"d":return M.getDate();case"dd":return I(M.getDate());case"H":return M.getHours();case"HH":return I(M.getHours());case"h":return M.getHours()%12;case"hh":return I(M.getHours()%12);case"m":return M.getMinutes();case"mm":return I(M.getMinutes());case"s":return M.getSeconds();case"ss":return I(M.getSeconds());default:return N}});return L};function K(M){if(!M){return document}var L=M.target;if(!L){L=M.srcElement}if(L.nodeType===3){L=L.parentNode}return L||document}function I(L){return("0"+L).slice(-2)}function a(M,L){for(var N in M){if(!L.hasOwnProperty(N)){L[N]=M[N]}}return L}function j(Q,M){if(!M){return}Q||(Q=document.body);var L=M.length,O,P;for(var N=0;N<L;N++){O=M[N];if(typeof O=="string"){Q.appendChild(document.createTextNode(O))}else{P=document.createElement(O[0]);if(O[1]){P.className=O[1]}if(O[2]){P.innerHTML=O[2]}Q.appendChild(P);M[N]=P}}}function J(O,Q,N,M,L){var P=document.createElement(O.toUpperCase());Q&&(P.id=Q);M&&(P.className=M);L&&(P.innerHTML=L);N||(N=document.body);return N.appendChild(P)}function x(L,N){var M=new Date(L);M.setDate(N);return M.getDay()}function A(L){var N,M=f[L.getMonth()];if(M!=28){return M}N=L.getFullYear();if(N%4==0&&N%100!=0||N%400==0){return 29}return M}function G(N,O,P){O.className="calendar-quick-contents date-part-y";P=P||(N-11);if(P<0){P=0}var M="<a>&lt;&lt;&lt;</a>";for(var L=P;L<P+23;L++){M+="<a"+(L==N?' class="hover"':"")+">"+L+"</a>"}M+="<a>&gt;&gt;&gt;</a>";F(O,M);t(O.parentNode)}function e(O,N){var M='<div class="date-part-M">';for(var L=1;L<=12;L++){M+="<a"+(L==O?' class="hover"':"")+">"+L+"</a>"}F(N,M+"</div>");t(N.parentNode)}function y(Q,R,M,P){var O='<div class="date-part-'+P+'">',L="";for(var N=0;N<=M;N++){L="";if(N==R){L+="hover "}if(N%2==1){L+="odd "}if(L!=""){L=L.slice(0,-1)}O+="<a"+(L!=""?' class="'+L+'"':"")+">"+N+"</a>"}F(Q,O+"</div>");t(Q.parentNode)}function F(M,L){if(L===true){return parseInt(M.innerHTML)}if(L!==undefined){M.innerHTML=typeof L=="object"?L.innerHTML:L}return M.innerHTML}function w(M,L){return M.offsetLeft+Math.floor(M.offsetWidth/2)+L}function t(M,L){M.style.display=L||"block"}function D(L){L.style.display="none"}function o(L){return L.getFullYear()+("0"+(L.getMonth()+1)).slice(-2)+("0"+L.getDate()).slice(-2)}function i(L){return L.style.display!="none"}function c(L){return L.nextSibling}function m(L){return L.previousSibling}function E(ai,M){var Y=0,R=M.cell_height||0,ac=0,ad='<div class="b"></div><div class="a"></div>';if(M.width){ac=Math.floor(M.width/7);Y=ac*7;M.cell_width=ac}var ae=J("div",null,ai,"calendar-main inline-block"),L=null,Z=null,S,Q,P,X,ag,W,U,T,V,af,aa,ah,O,N;if(Y>0){ae.style.width=Y+"px"}if(M.has_container!==true){L=J("div",null,ae,"calendar-arraw calendar-arraw-up",ad)}S=J("div",null,ae,"calendar-header");Q=J("div",null,ae,"calendar-quick");P=J("div",null,Q,"calendar-arraw calendar-arraw-up",ad);X=J("div",null,Q,"calendar-quick-contents");ag=J("div",null,Q,"calendar-arraw calendar-arraw-down",ad);W=[["li","area-left"],["li","area-middle"],["li","area-right"],["li","area-left area-month-left"],["li","area-middle-month"],["li","area-right area-month-right"]];j(J("ul",null,S,"select-box"),W);U=W[1];T=W[4];D(Q);while(W.length>0){W.pop()}V=J("div",null,ae,"calendar-body-wapper");af=J("ul",null,V,"calendar-body");for(var ab=0;ab<7;ab++){N=J("li",false,af,"weeks",M.weeks[ab%7]);if(ac>0){N.style.width=ac+"px"}}if(M.show_time===true){W=[["div","calendar-hours","0"],":",["div","calendar-minutes","0"],":",["div","calendar-seconds","0"]];j(J("div",null,V,"calendar-time"),W);aa=W[0];ah=W[2];O=W[4];while(W.length>0){W.pop()}}if(M.has_container!==true){Z=J("div",null,V,"calendar-arraw calendar-arraw-down",ad)}return{year:U,month:T,weeks:af,main:ae,quick:Q,quick_content:X,hours:aa,minutes:ah,seconds:O,arraw_down:Z,arraw_up:L,down:ag,up:P}}function b(M){var L={x:M.offsetLeft,y:M.offsetTop,h:M.offsetHeight};M=M.offsetParent;while(M){L.x+=M.offsetLeft;L.y+=M.offsetTop;M=M.offsetParent}return L}function H(O,N){t(O.main);var P=b(N),M=P.y+P.h,L=P.x;t(O.arraw_up);D(O.arraw_down);if(M+O.main.offsetHeight>k()+B()){M=P.y-O.main.offsetHeight-5;D(O.arraw_up);t(O.arraw_down)}else{M+=5}O.main.style.cssText="position:absolute; top:"+M+"px; left:"+L+"px;"}function k(){if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}if(window.innerWidth){return window.innerHeight}if(document.body&&document.body.clientWidth){return document.body.clientHeight}return 0}function B(){if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}return(window.pageYOffset||document.body.scrollTop)||0}function d(L){if(L&&L.stopPropagation){L.stopPropagation()}else{window.event.cancelBubble=true}}function r(O,N,M,L){if(O.addEventListener){O.addEventListener(N,M,L!==true)}else{if(O.attachEvent){O.attachEvent("on"+N,M)}else{O["on"+N]=M}}}function n(M,L){var N=M.parentNode;while(N){if(N==L){return true}N=N.parentNode}return false}function C(L){if(typeof L!="string"){return L}var M=/^(\d{4})\-(\d{1,2})\-(\d{1,2})( (\d{1,2})\:(\d{1,2})\:(\d{1,2}))?$/.exec(L);if(!M){return null}if(M[4]){return new Date(parseInt(M[1]),parseInt(M[2])-1,parseInt(M[3]),parseInt(M[5]),parseInt(M[6]),parseInt(M[7]))}return new Date(parseInt(M[1]),parseInt(M[2])-1,parseInt(M[3]))}function p(L){if(L&&typeof L=="object"){return L}return new RegExp("\\b("+L.replace(/\-/g,"\\-").replace(/\s+/g,"|")+")\\b","g")}function v(N,L,M){N.className=((N.className||"").replace(p(L),"")+" "+(M||L)).replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function g(M,L){M.className=(M.className||"").replace(p(L),"").replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function q(M,L){return p(L).test(M.className||"")}function h(O,L){var N=p(L),M=q(O,N);if(M){g(O,N)}else{v(O,N,L)}return M}var s=window.Eson=function(X,ad,S){ad=ad||{};if(ad.multi===true){ad.multi=null;return l(X,ad)}var R={date:null,weeks:"日一二三四五六",onselect:null,first_week_day:0,weeks_count:1,multi_select:false,min:0,max:0,control_union:false},U=[],ae=null,ag=S||{},M,am,at=null;if(ad.min){ad.min=+C(ad.min)}if(ad.max){ad.max=+C(ad.max)}for(var ak in ad){if(!ad.hasOwnProperty(ak)){continue}R[ak]=ad[ak]}if(typeof R.weeks=="string"){R.weeks=R.weeks.split("")}"string"==typeof(X)&&(X=document.getElementById(X));if(!X){if(R.onerror){R.onerror("target element error.")}return}var ar=X.tagName.toLowerCase();if(ar=="input"){if(X.type!="text"){if(R.onerror){R.onerror("target element error.")}return}}function aj(au){return F(ae.hours,au)}function ao(au){return F(ae.minutes,au)}function Q(au){return F(ae.seconds,au)}function L(){return F(ae.year,true)}function aa(){return F(ae.month,true)}function ab(au){F(ae.hours,au.getHours());F(ae.minutes,au.getMinutes());F(ae.seconds,au.getSeconds())}function al(au,ax,aw,av){t(ae.up,au);ae.up.style.marginLeft=aw;t(ae.down,ax);ae.down.style.marginLeft=av}function Y(av){var au=null;while((au=av.parentNode.className)!="calendar-body"){if(au.indexOf("calendar-main")>=0){return null}av=av.parentNode}return av}function P(aN){if(!ae){return}var aP=K(aN||event);if(aP==document){return}var aJ=Y(aP);if(aJ){if(q(aJ,"weeks")){if(R.multi_select!==true){return}var aE=ae.weeks.getElementsByTagName("li"),aF,aK,aL,aA=-1;for(var aM=0;aM<aE.length;aM++){if(aJ==aE[aM]){aA=aM}else{if(aA>=0&&aM%7==aA){aF=new Date(L(),aE[aM].month-1,aE[aM].day);aL=o(aF);if(ag[aL]){ag[aL]=null}else{ag[aL]=aF}if(aE[aM].isInMonth){aK=aF}}}}if(aK){ac(aK)}ap(Z);h(aJ,"checked")}else{if(q(aJ,"readonly")){return}else{D(ae.quick);var au=new Date(aJ.year,aJ.month-1,aJ.day),aw=[au.getFullYear(),I(au.getMonth()+1),I(au.getDate())];g(aJ,"current");if(R.multi_select===true){aw.push(!h(aJ,"selected"))}else{if(am){g(am,"selected")}am=aJ;v(aJ,"selected");ag={};ag[o(au)]=au;if(R.show_time===true){aw.push(I(aj()),I(ao()),I(Q()))}aw.push(aJ);M=au}if(R.onselect){R.onselect.apply(au,aw)}if(R.multi_select!==true&&!aJ.isInMonth){ac(au)}if(R.remain!==true){D(ae.main)}}}}var aQ=aP.tagName.toLowerCase(),az=aP.className||"",aD=aP.parentNode.className||"";var aI=ae.quick_content,aG=ae.quick;if(aD=="calendar-time"){var ay=0,aO,av="",ax="h";if(az=="calendar-hours"){ay=23}else{if(az=="calendar-minutes"||az=="calendar-seconds"){ay=59;av=" calendar-quick-minorsec";ax=az=="calendar-seconds"?"s":"m"}}if(ay>0){al("none","block","0",w(aP,-4)+"px");aO=F(aP,true);if(at!=az||aG.style.display=="none"){at=az;y(aI,aO,ay,ax);aG.className="calendar-quick calendar-quick-time"+av;aG.style.marginTop=(ae.weeks.offsetHeight-aG.offsetHeight)+"px"}else{D(aG)}}return}if(aD.indexOf("date-part-")>=0){if(aD.indexOf("date-part-h")>=0){aj(F(aP,true))}else{if(aD.indexOf("date-part-m")>=0){ao(F(aP,true))}else{if(aD.indexOf("date-part-s")>=0){Q(F(aP,true))}else{if(aD.indexOf("date-part-y")>=0){var aB=F(aP);if(aB=="&lt;&lt;&lt;"){G(F(ae.year,true),aP.parentNode,F(c(aP),true)-23);return}else{if(aB=="&gt;&gt;&gt;"){G(F(ae.year,true),aP.parentNode,F(m(aP),true)+1);return}else{aB=parseInt(aB);if(R.after_select_year){R.after_select_year(aB,0)}ah(aB)}}}else{ah(null,F(aP,true))}}}}D(aG);an();return}if(q(aP,"area-month-left")){ah(null,F(c(aP),true)-1);var aH=F(c(aP),true);if(i(aG)){e(aH,aI)}if(R.after_select_month){R.after_select_month(aH,-1)}return}if(q(aP,"area-month-right")){ah(null,F(m(aP),true)+1);var aH=F(m(aP),true);if(i(aG)){e(aH,aI)}if(R.after_select_month){R.after_select_month(aH,1)}return}if(q(aP,"area-middle-month")){if(at!="month"||aG.style.display=="none"){e(F(aP,true),aI);at="month";aG.style.marginTop="2px";aG.className="calendar-quick";al("block","none",w(aP,-4)+"px","0")}else{D(aG)}return}if(q(aP,"area-left")){var aC=F(c(aP),true)-1;if(aC<=99){return}if(i(aG)){G(aC,aI,null)}ah(aC);if(R.after_select_year){R.after_select_year(aC,-1)}return}if(q(aP,"area-right")){var aC=F(m(aP),true)+1;if(i(aG)){G(aC,aI,null)}ah(aC);if(R.after_select_year){R.after_select_year(aC,1)}return}if(q(aP,"area-middle")){if(at!="year"||aG.style.display=="none"){G(F(aP,true),aI,null);at="year";aG.style.marginTop="2px";aG.className="calendar-quick";al("block","none",w(aP,-4)+"px","0")}else{D(_quick)}return}}function O(av){var az=ae.weeks,ay;U.length=0;while(az.childNodes.length>7){ay=az.removeChild(az.lastChild);ay.innerHTML="";ay.onmouseover=ay.onmouseout=null}ay=null;var ax=av*7,au=ax-7;for(var aw=0;aw<ax;aw++){U[aw]=J("li",false,az,aw>=au?"calendar-last-line":"")}}function ac(aw){am=null;if(R.before_render){R.before_render(aw)}var au=x(aw,1)-R.first_week_day;if(au<0){au=7+au}var aA=1,aE=aw.getFullYear(),ax=aw.getMonth()+1,aD=aw.getDate();F(ae.year,aE);F(ae.month,ax);var aG=A(aw)+au,aH=R.lines||Math.ceil(aG/7),aF=aH*7;O(aH);for(var ay=0;ay<aF;ay++){var az=U[ay],aC;az.isInMonth=false;if(ay<au||ay>(aG-1)){v(az,"disabled");if(ay<au){var aB=(new Date(+aw));aB.setDate(ay-au+1);az.day=aB.getDate();az.month=ax-1}else{az.day=ay-aG+1;az.month=ax+1}}else{az.month=ax;az.day=aA;az.isInMonth=true;var av=x(aw,aA)%7;if(av==0||av==6){v(az,"sunday")}aA++}aC=new Date(aE,az.month-1,az.day);az.year=aE;F(az,"<div>"+(R.date_up?(R.date_up.call(az,aE,az.month,az.day)||az.day):az.day)+"</div>");if(ag[o(aC)]){v(az,"selected");am=az}aC=+aC;if(R.min>0&&aC<R.min||R.max>0&&aC>R.max){g(az,"selected sunday");v(az,"disabled readonly");az.onmouseout=az.onmouseover=function(){}}else{az.onmouseover=function(){if(!q(this,"selected")){v(this,"current")}};az.onmouseout=function(){g(this,"current")}}}if(R.cell_width||R.cell_height){for(var ay=0;ay<U.length;ay++){if(R.cell_width){U[ay].style.width=R.cell_width+"px";U[ay].childNodes[0].style.width=(R.cell_width-4)+"px"}if(R.cell_height){U[ay].style.height=R.cell_height+"px";U[ay].childNodes[0].style.height=(R.cell_height-4)+"px"}}}if(R.after_render){R.after_render(aw)}}function ah(au,av){au||(au=F(ae.year,true));if(av!==0){av||(av=F(ae.month,true))}while(av<=0){av=12+av;au--}while(av>12){av-=12;au++}ac(new Date(au,av-1,1))}function ap(aw){var au=[];for(var av in ag){if(ag.hasOwnProperty(av)&&ag[av]){au.push(u(ag[av],R.format?R.format:"yyyy-MM-dd"))}}if(aw){aw.call(ag,au)}else{X.value=au.join(",")}}function an(av){av=av||M;var au=[av.getFullYear(),I(av.getMonth()+1),I(av.getDate())];if(R.show_time===true){au.push(I(aj()),I(ao()),I(Q()))}R.onselect.apply(M,au)}M=R.date;if(!M&&X.value){M=X.value}if(R.multi_select===true){var T={},W=0;if(M){var af,ai,V;if(typeof M=="string"){M=M.split(",")}for(var ak=0;ak<M.length;ak++){af=C(M[ak]);ai=o(af);ag[ai]=af;V=ai.substr(0,6);if(!T.hasOwnProperty(V)){T[V]=[];W++}T[V].push(af)}if(W>1&&R.multi!==false){R.max_count=R.max_count||0;R.set_up_months=[];for(var ak in T){if(T.hasOwnProperty(ak)){R.set_up_months.push(T[ak][0])}}if(R.max_count>0&&W>R.max_count){W=R.max_count}R.count=W;return l(X,R,ag)}}else{M=[]}var Z=R.onselect;R.onselect=function(ax,au,aw,av){if(av){ag[ax+au+aw]=this}else{ag[ax+au+aw]=null}ap(Z)};ap(Z);R.remain=true;M=C(M[0]);if(!M){M=new Date()}}else{M=C(M);if(!M){M=new Date()}ag[o(M)]=M;if(!R.onselect){R.onselect=function(az,ay,ax,aw,au,av){X.value=R.format?u(this,R.format):(az+"-"+ay+"-"+ax+(R.show_time===true?(" "+aw+":"+au+":"+av):""))}}var N=[M.getFullYear(),I(M.getMonth()+1),I(M.getDate())];if(R.show_time===true){N.push(I(M.getHours()),I(M.getMinutes()),I(M.getSeconds()))}R.onselect.apply(M,N)}var aq=null;if(ar=="input"){r(document,"click",function(av){if(!ae||!ae.main){return}var au=K(av||event);if(X==au||ae.main==au||n(au,ae.main)){return}D(ae.main)});r(X,"focus",function(au){H(ae,X)})}else{if(ar=="div"){R.remain=true;aq=X}else{r(document,"click",function(av){if(!ae||!ae.main){return}var au=K(av||event);if(ae.main==au||n(au,ae.main)){return}D(ae.main)});r(X,"click",function(au){d(au);H(ae,R.bindto||X)})}}ae=E(aq,R);if(!aq){D(ae.main)}ae.main.onclick=P;z++;if(R.set_up_date){M=C(R.set_up_date)||M}ac(M);if(R.show_time===true){ab(M)}return{options:R,controls:ae,set_up:ah,id:z,year:L,month:aa}};s.format=u;s.on=r;s.cancel_bubble=d;s.child_of=n;var l=function(L,P,T){var Q=[],S=null;function R(Y,ac,ab,ad){if(ab==0){return}var Z;for(var aa=0;aa<Q.length;aa++){if(aa!=ad){Z=Q[aa];if(Y=="y"){Z.set_up(Z.year()+ab)}else{Z.set_up(null,Z.month()+ab)}}}}function U(){var ab=J("div",null,null,"calendar-group inline-block"),ad,Z,Y;Y=J("div",null,ab,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');for(var aa=0;aa<X.count;aa++){if(X.set_up_months){ad=X.set_up_months[aa]}S=s(ab,a(X,{set_up_date:ad||new Date(),has_container:true}),T);if(X.control_union===true){S.options.after_select_year=(function(ae){return function(ag,af){R("y",ag,af,ae)}})(Q.length);S.options.after_select_month=(function(ae){return function(ag,af){R("m",ag,af,ae)}})(Q.length);Q.push(S)}S=null}if(X.show_close!==false){var ac=J("div",null,ab,"calendar-close","x");ac.onclick=function(){D(ab)}}Z=J("div",null,ab,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');return{main:ab,arraw_up:Y,arraw_down:Z}}var X={date:[],onselect:null,count:2},V=null,M=[];for(var N in P){if(!P.hasOwnProperty(N)){continue}X[N]=P[N]}X.remain=true;X.lines=6;if(!X.onselect){X.onselect=function(Y){L.value=Y.join(",")}}"string"==typeof(L)&&(L=document.getElementById(L));if(!L){if(X.onerror){X.onerror("target element error.")}return}var W=L.tagName.toLowerCase(),O=false;if(W=="input"){if(L.type!="text"){if(X.onerror){X.onerror("target element error.")}return}r(document,"click",function(Z){if(!V||!V.main){return}var Y=K(Z||event);if(L==Y||V.main==Y||n(Y,V.main)){return}D(V.main)});r(L,"focus",function(){H(V,L)})}else{if(W=="div"){O=true}else{r(document,"click",function(Z){if(!V||!V.main){return}var Y=K(Z||event);if(V.main==Y||n(Y,V.main)){return}D(V.main)});r(L,"click",function(Y){d(Y);H(V,L)})}}V=U();if(O){L.appendChild(V.main)}else{D(V.main)}return{options:X,controls:V}}})();