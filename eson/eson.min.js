/*!
Eson Date input control
first create by 'UANV,ESONCalendar and so on'
modify by anlige @ www.thinkasp.cn
last modify at 2015-10-26
*/
(function(){var j=0,u=[31,28,31,30,31,30,31,31,30,31,30,31];var B=function(J,I){J=J||(new Date());I=I.replace(/(yyyy|mm|dd|hh|ss|m|d|h|s)/ig,function(K){switch(K){case"yyyy":return J.getFullYear();case"M":return J.getMonth()+1;case"MM":return C(J.getMonth()+1);case"d":return J.getDate();case"dd":return C(J.getDate());case"H":return J.getHours();case"HH":return C(J.getHours());case"h":return J.getHours()%12;case"hh":return C(J.getHours()%12);case"m":return J.getMinutes();case"mm":return C(J.getMinutes());case"s":return J.getSeconds();case"ss":return C(J.getSeconds());default:return K}});return I};function c(J){if(!J){return document}var I=J.target;if(!I){I=J.srcElement}if(I.nodeType===3){I=I.parentNode}return I||document}function C(I){return("0"+I).slice(-2)}function x(J,I){for(var K in J){if(!I.hasOwnProperty(K)){I[K]=J[K]}}return I}function A(N,J){if(!J){return}N||(N=document.body);var I=J.length,L,M;for(var K=0;K<I;K++){L=J[K];if(typeof L=="string"){N.appendChild(document.createTextNode(L))}else{M=document.createElement(L[0]);if(L[1]){M.className=L[1]}if(L[2]){M.innerHTML=L[2]}N.appendChild(M);J[K]=M}}}function H(L,N,K,J,I){var M=document.createElement(L.toUpperCase());N&&(M.id=N);J&&(M.className=J);I&&(M.innerHTML=I);K||(K=document.body);return K.appendChild(M)}function h(I,K){var J=new Date(I);J.setDate(K);return J.getDay()}function F(I){var K,J=u[I.getMonth()];if(J!=28){return J}K=I.getFullYear();if(K%4==0&&K%100!=0||K%400==0){return 29}return J}function e(L,M,O,N,K){O=O||(L-11);if(O<0){O=0}var J="<a>&lt;&lt;&lt;</a>";for(var I=O;I<O+23;I++){J+="<a"+(I==L?' class="hover"':"")+">"+I+"</a>"}J+="<a>&gt;&gt;&gt;</a>";z(M,J);G(M.parentNode);M.onclick=function(S){var R=c(S||event);if(R&&R.tagName){var P=R.tagName.toLowerCase(),Q;if(P=="a"){Q=z(R);if(Q=="&lt;&lt;&lt;"){e(L,M,O-23,N,K)}else{if(Q=="&gt;&gt;&gt;"){e(L,M,O+23,N,K)}else{Q=parseInt(Q);N(Q);t(M.parentNode);if(K.after_select_year){K.after_select_year(Q,0)}}}}}}}function b(M,L,N,K){var J="<div>";for(var I=1;I<=12;I++){J+="<a"+(I==M?' class="hover"':"")+">"+I+"</a>"}z(L,J+"</div>");G(L.parentNode);L.onclick=function(R){var Q=c(R||event);if(Q&&Q.tagName){var O=Q.tagName.toLowerCase(),P;if(O=="a"){P=z(Q,true);N(null,P);t(L.parentNode);if(K.after_select_month){K.after_select_month(m,0)}}}}}function D(N,P,J,O,M){var L="<div>",I="";for(var K=O||0;K<=J;K++){I="";if(K==P){I+="hover "}if(K%2==1){I+="odd "}if(I!=""){I=I.slice(0,-1)}L+="<a"+(I!=""?' class="'+I+'"':"")+">"+K+"</a>"}z(N,L+"</div>");G(N.parentNode)}function z(J,I){if(I===true){return parseInt(J.innerHTML)}if(I!==undefined){J.innerHTML=typeof I=="object"?I.innerHTML:I}return J.innerHTML}function p(J,I){return J.offsetLeft+Math.floor(J.offsetWidth/2)+I}function G(J,I){J.style.display=I||"block"}function t(I){I.style.display="none"}function s(I){return I.getFullYear()+("0"+(I.getMonth()+1)).slice(-2)+("0"+I.getDate()).slice(-2)}function E(I){return I.style.display!="none"}function w(ao,J,ac,al){var Z=0,R=J.cell_height||0,ag=0;if(J.width){ag=Math.floor(J.width/7);Z=ag*7;J.cell_width=ag}var ap="";var aj=H("div",null,ao,"calendar-main inline-block"),I=null,aa=null;if(Z>0){aj.style.width=Z+"px"}if(J.has_container!==true){I=H("div",null,aj,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>')}var T=H("div",null,aj,"calendar-header");var Q=H("div",null,aj,"calendar-quick");var M=H("div",null,Q,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');var Y=H("div",null,Q,"calendar-quick-contents");var am=H("div",null,Q,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');function ah(aq,au,at,ar){G(M,aq);M.style.marginLeft=at;G(am,au);am.style.marginLeft=ar}var af=H("ul",null,T,"select-box"),X=[["li","area-left"],["li","area-middle"],["li","area-right"],["li","area-left area-month"],["li","area-middle-month"],["li","area-right"]];A(af,X);var N=X[0],V=X[1],P=X[2],O=X[3],S=X[4],ai=X[5];t(Q);N.onclick=function(){var aq=z(V,true)-1;if(aq<=99){return}if(E(Q)){e(aq,Y,null,ac,J)}ac(aq);if(J.after_select_year){J.after_select_year(aq,-1)}};P.onclick=function(){var aq=z(V,true)+1;if(E(Q)){e(aq,Y,null,ac,J)}ac(aq);if(J.after_select_year){J.after_select_year(aq,1)}};V.onclick=function(){if(ap!="year"||Q.style.display=="none"){e(z(V,true),Y,null,ac,J);ap="year";Q.style.marginTop="2px";Q.className="calendar-quick";ah("block","none",p(V,-4)+"px","0")}else{t(Q)}};O.onclick=function(){ac(null,z(S,true)-1);var aq=z(S,true);if(E(Q)){b(aq,Y,ac,J)}if(J.after_select_month){J.after_select_month(aq,-1)}};ai.onclick=function(){ac(null,z(S,true)+1);var aq=z(S,true);if(E(Q)){b(aq,Y,ac,J)}if(J.after_select_month){J.after_select_month(aq,1)}};S.onclick=function(){if(ap!="month"||Q.style.display=="none"){b(z(S,true),Y,ac,J);ap="month";Q.style.marginTop="2px";Q.className="calendar-quick";ah("block","none",p(S,-4)+"px","0")}else{t(Q)}};var W=H("div",null,aj,"calendar-body-wapper");var ak=H("ul",null,W,"calendar-body"),K;for(var ae=0;ae<7;ae++){K=H("li",false,ak,"weeks",J.weeks[ae%7]);if(ag>0){K.style.width=ag+"px"}}if(J.show_time===true){var U=H("div",null,W,"calendar-time"),ab=[["div","calendar-hours","0"],":",["div","calendar-minutes","0"],":",["div","calendar-seconds","0"]];A(U,ab);var ad=ab[0],an=ab[2],L=ab[4];U.onclick=function(av){var au=c(av||event),at=au.className,aq=0,aw,ar="";if(at=="calendar-hours"){aq=23;Y.onclick=function(az){var ay=c(az||event);if(ay&&ay.tagName){var ax=ay.tagName.toLowerCase();if(ax=="a"){z(ad,ay);t(Q);al()}}};ah("none","block","0",p(ad,-4)+"px")}else{if(at=="calendar-minutes"||at=="calendar-seconds"){aq=59;Y.onclick=function(az){var ay=c(az||event);if(ay&&ay.tagName){var ax=ay.tagName.toLowerCase();if(ax=="a"){if(at=="calendar-minutes"){z(an,ay)}else{if(at=="calendar-seconds"){z(L,ay)}}t(Q);al()}}};ah("none","block","0",p(at=="calendar-seconds"?L:an,-4)+"px");ar=" calendar-quick-minorsec"}}if(aq>0){aw=z(au,true);if(ap!=at||Q.style.display=="none"){ap=at;D(Y,aw,aq);Q.className="calendar-quick calendar-quick-time"+ar;Q.style.marginTop=(ak.offsetHeight-Q.offsetHeight)+"px"}else{t(Q)}}}}if(J.has_container!==true){aa=H("div",null,W,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>')}return{year:V,month:S,weeks:ak,main:aj,quick:Q,quick_content:Y,time:{hours:function(aq){return z(ad,aq)},minutes:function(aq){return z(an,aq)},seconds:function(aq){return z(L,aq)},set:function(aq){z(ad,aq.getHours());z(an,aq.getMinutes());z(L,aq.getSeconds())}},date:{year:function(){return z(V,true)},month:function(){return z(S,true)}},arraw_down:aa,arraw_up:I}}function y(J){var I={x:J.offsetLeft,y:J.offsetTop,h:J.offsetHeight};J=J.offsetParent;while(J){I.x+=J.offsetLeft;I.y+=J.offsetTop;J=J.offsetParent}return I}function v(L,K){G(L.main);var M=y(K),J=M.y+M.h,I=M.x;G(L.arraw_up);t(L.arraw_down);if(J+L.main.offsetHeight>o()+d()){J=M.y-L.main.offsetHeight-5;t(L.arraw_up);G(L.arraw_down)}else{J+=5}L.main.style.cssText="position:absolute; top:"+J+"px; left:"+I+"px;"}function o(){if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}if(window.innerWidth){return window.innerHeight}if(document.body&&document.body.clientWidth){return document.body.clientHeight}return 0}function d(){if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}return(window.pageYOffset||document.body.scrollTop)||0}function n(I){if(I&&I.stopPropagation){I.stopPropagation()}else{window.event.cancelBubble=true}}function r(L,K,J,I){if(L.addEventListener){L.addEventListener(K,J,I!==true)}else{if(L.attachEvent){L.attachEvent("on"+K,J)}else{L["on"+K]=J}}}function i(J,I){var K=J.parentNode;while(K){if(K==I){return true}K=K.parentNode}return false}function l(I){if(typeof I!="string"){return I}var J=/^(\d{4})\-(\d{1,2})\-(\d{1,2})( (\d{1,2})\:(\d{1,2})\:(\d{1,2}))?$/.exec(I);if(!J){return null}if(J[4]){return new Date(parseInt(J[1]),parseInt(J[2])-1,parseInt(J[3]),parseInt(J[5]),parseInt(J[6]),parseInt(J[7]))}return new Date(parseInt(J[1]),parseInt(J[2])-1,parseInt(J[3]))}function g(J,I){J.className=((J.className||"").replace(new RegExp("\\b"+I.replace(/\-/g,"\\-")+"\\b","g"),"")+" "+I).replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function a(J,I){J.className=(J.className||"").replace(new RegExp("\\b"+I.replace(/\-/g,"\\-")+"\\b","g"),"").replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function f(J,I){return(new RegExp("\\b"+I.replace(/\-/g,"\\-")+"\\b","g")).test((J.className||""))}var k=window.Eson=function(R,U,M){U=U||{};if(U.multi===true){U.multi=null;return q(R,U)}var K=function(ae){var ah=V.weeks;O.length=0;while(ah.childNodes.length>7){ah.removeChild(ah.lastChild)}for(var ag=0;ag<ae;ag++){for(var af=0;af<7;af++){O[ag*7+af]=H("li",false,ah,false,"&nbsp;");if(ag==ae-1){g(O[ag*7+af],"calendar-last-line")}}}};var T=function(ag){if(L.before_render){L.before_render(ag)}var ae=h(ag,1)-L.first_week_day;if(ae<0){ae=7+ae}var ak=1,ao=ag.getFullYear(),ah=ag.getMonth()+1,an=ag.getDate();z(V.year,ao);z(V.month,ah);var aq=F(ag)+ae,ar=L.lines||Math.ceil(aq/7),ap=ar*7;K(ar);for(var ai=0;ai<ap;ai++){var aj=O[ai],am;aj.isInMonth=false;if(ai<ae||ai>(aq-1)){g(aj,"disabled");if(ai<ae){var al=(new Date(+ag));al.setDate(ai-ae+1);aj.day=al.getDate();aj.month=ah-1}else{aj.day=ai-aq+1;aj.month=ah+1}am=new Date(ao,aj.month-1,aj.day)}else{am=new Date(ao,ah-1,ak);aj.month=ah;aj.day=ak;aj.isInMonth=true;var af=h(ag,ak)%7;if(af==0||af==6){g(aj,"sunday")}aj.onmouseover=function(){if(!f(this,"selected")){g(this,"current")}};aj.onmouseout=function(){a(this,"current")};ak++}z(aj,"<div>"+(L.date_up?(L.date_up.call(aj,ao,aj.month,aj.day)||aj.day):aj.day)+"</div>");if(X[s(am)]){g(aj,"selected")}am=+am;if(L.min>0&&am<L.min||L.max>0&&am>L.max){a(aj,"selected");a(aj,"sunday");g(aj,"disabled");aj.onmouseout=aj.onmouseover=function(){}}else{aj.onclick=function(){t(V.quick);an=this.day;var aw=new Date(ao,this.month-1,an),au=[aw.getFullYear(),C(aw.getMonth()+1),C(aw.getDate())];a(this,"current");if(L.multi_select===true){if(f(this,"selected")){a(this,"selected");au.push(false)}else{g(this,"selected");au.push(true)}}else{for(var av=0;av<O.length;av++){a(O[av],"selected")}g(this,"selected");for(var at in X){if(X.hasOwnProperty(at)){X[at]=null}}X[s(aw)]=aw;if(L.show_time===true){au.push(C(V.time.hours()),C(V.time.minutes()),C(V.time.seconds()))}au.push(this);I=aw}if(L.onselect){L.onselect.apply(aw,au)}if(L.multi_select!==true&&!this.isInMonth){return T(aw)}if(L.remain!==true){t(V.main)}}}}if(L.cell_width||L.cell_height){for(var ai=0;ai<O.length;ai++){if(L.cell_width){O[ai].style.width=L.cell_width+"px";O[ai].childNodes[0].style.width=(L.cell_width-4)+"px"}if(L.cell_height){O[ai].style.height=L.cell_height+"px";O[ai].childNodes[0].style.height=(L.cell_height-4)+"px"}}}if(L.after_render){L.after_render(ag)}};var Y=function(ae,af){ae||(ae=z(V.year,true));if(af!==0){af||(af=z(V.month,true))}while(af<=0){af=12+af;ae--}while(af>12){af-=12;ae++}T(new Date(ae,af-1,1))};var ac=function(ag){var ae=[];for(var af in X){if(X.hasOwnProperty(af)&&X[af]){ae.push(B(X[af],L.format?L.format:"yyyy-MM-dd"))}}if(ag){ag.call(X,ae)}else{R.value=ae.join(",")}};var ab=function(af){af=af||I;var ae=[af.getFullYear(),C(af.getMonth()+1),C(af.getDate())];if(L.show_time===true){ae.push(C(V.time.hours()),C(V.time.minutes()),C(V.time.seconds()))}L.onselect.apply(I,ae)};var L={date:null,weeks:"日一二三四五六",onselect:null,first_week_day:0,weeks_count:1,multi_select:false,min:0,max:0,control_union:false},O=[],V=null,X=M||{},I;if(U.min){U.min=+l(U.min)}if(U.max){U.max=+l(U.max)}for(var aa in U){if(!U.hasOwnProperty(aa)){continue}L[aa]=U[aa]}if(typeof L.weeks=="string"){L.weeks=L.weeks.split("")}"string"==typeof(R)&&(R=document.getElementById(R));if(!R){if(L.onerror){L.onerror("target element error.")}return}var ad=R.tagName.toLowerCase();if(ad=="input"){if(R.type!="text"){if(L.onerror){L.onerror("target element error.")}return}}I=L.date;if(!I&&R.value){I=R.value}if(L.multi_select===true){var N={},Q=0;if(I){var W,Z,P;if(typeof I=="string"){I=I.split(",")}for(var aa=0;aa<I.length;aa++){W=l(I[aa]);Z=s(W);X[Z]=W;P=Z.substr(0,6);if(!N.hasOwnProperty(P)){N[P]=[];Q++}N[P].push(W)}if(Q>1&&L.multi!==false){L.max_count=L.max_count||0;L.set_up_months=[];for(var aa in N){if(N.hasOwnProperty(aa)){L.set_up_months.push(N[aa][0])}}if(L.max_count>0&&Q>L.max_count){Q=L.max_count}L.count=Q;return q(R,L,X)}}else{I=[]}var S=L.onselect;L.onselect=function(ah,ae,ag,af){if(af){X[ah+ae+ag]=this}else{X[ah+ae+ag]=null}ac(S)};ac(S);L.remain=true;I=l(I[0]);if(!I){I=new Date()}}else{I=l(I);if(!I){I=new Date()}X[s(I)]=I;if(!L.onselect){L.onselect=function(aj,ai,ah,ag,ae,af){R.value=L.format?B(this,L.format):(aj+"-"+ai+"-"+ah+(L.show_time===true?(" "+ag+":"+ae+":"+af):""))}}var J=[I.getFullYear(),C(I.getMonth()+1),C(I.getDate())];if(L.show_time===true){J.push(C(I.getHours()),C(I.getMinutes()),C(I.getSeconds()))}L.onselect.apply(I,J)}if(ad=="input"){r(document,"click",function(af){if(!V||!V.main){return}var ae=c(af||event);if(R==ae||V.main==ae||i(ae,V.main)){return}t(V.main)});r(R,"focus",function(ae){v(V,R)});V=w(null,L,Y,ab);t(V.main)}else{if(ad=="div"){L.remain=true;V=w(R,L,Y,ab)}else{r(document,"click",function(af){if(!V||!V.main){return}var ae=c(af||event);if(V.main==ae||i(ae,V.main)){return}t(V.main)});r(R,"click",function(ae){n(ae);v(V,L.bindto||R)});V=w(null,L,Y,ab);t(V.main)}}j++;if(L.multi_select===true){r(V.weeks,"click",function(ai){var aj=c(ai||event),ah=-1,af=aj.className;if(f(aj,"weeks")){var al=V.weeks.getElementsByTagName("li"),ak,am,ae;for(var ag=0;ag<al.length;ag++){if(aj==al[ag]){ah=ag}else{if(ah>=0&&ag%7==ah){ak=new Date(V.date.year(),al[ag].month-1,al[ag].day);ae=s(ak);if(X[ae]){X[ae]=null}else{X[ae]=ak}if(al[ag].isInMonth){am=ak}}}}if(am){T(am)}ac(S);if(f(aj,"checked")){a(aj,"checked")}else{g(aj,"checked")}}})}if(L.set_up_date){I=l(L.set_up_date)||I}T(I);if(L.show_time===true){V.time.set(I)}return{options:L,controls:V,set_up:Y,id:j}};k.format=B;k.on=r;k.cancel_bubble=n;k.child_of=i;var q=function(I,L,P){var M=[],O=null;function N(U,Y,X,Z){if(X==0){return}var V;for(var W=0;W<M.length;W++){V=M[W];if(V.id!=Z){if(U=="y"){V.set_up(V.controls.date.year()+X)}else{V.set_up(null,V.controls.date.month()+X)}}}}function Q(){var X=H("div",null,null,"calendar-group inline-block"),Z,V,U;U=H("div",null,X,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');for(var W=0;W<T.count;W++){if(T.set_up_months){Z=T.set_up_months[W]}O=k(X,x(T,{set_up_date:Z||new Date(),has_container:true}),P);if(T.control_union===true){O.options.after_select_year=(function(aa){return function(ac,ab){N("y",ac,ab,aa)}})(O.id);O.options.after_select_month=(function(aa){return function(ac,ab){N("m",ac,ab,aa)}})(O.id);M.push(O)}O=null}if(T.show_close!==false){var Y=H("div",null,X,"calendar-close","x");Y.onclick=function(){t(X)}}V=H("div",null,X,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');return{main:X,arraw_up:U,arraw_down:V}}var T={date:[],onselect:null,count:2},R=null,J=[];for(var K in L){if(!L.hasOwnProperty(K)){continue}T[K]=L[K]}T.remain=true;T.lines=6;if(!T.onselect){T.onselect=function(U){I.value=U.join(",")}}"string"==typeof(I)&&(I=document.getElementById(I));if(!I){if(T.onerror){T.onerror("target element error.")}return}var S=I.tagName.toLowerCase();if(S=="input"){if(I.type!="text"){if(T.onerror){T.onerror("target element error.")}return}r(document,"click",function(V){if(!R||!R.main){return}var U=c(V||event);if(I==U||R.main==U||i(U,R.main)){return}t(R.main)});r(I,"focus",function(){v(R,I)});R=Q();t(R.main)}else{if(S=="div"){R=Q();I.appendChild(R.main)}else{r(document,"click",function(V){if(!R||!R.main){return}var U=c(V||event);if(R.main==U||i(U,R.main)){return}t(R.main)});r(I,"click",function(U){n(U);v(R,I)});R=Q();t(R.main)}}return{options:T,controls:R}}})();