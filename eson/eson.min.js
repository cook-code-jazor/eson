/*!
Eson Date input control
first create by 'UANV,ESONCalendar and so on'
modify by anlige @ www.thinkasp.cn
last modify at 2015-10-26
*/
(function(){var j=0,t=[31,28,31,30,31,30,31,31,30,31,30,31];var A=function(I,H){I=I||(new Date());H=H.replace(/(yyyy|mm|dd|hh|ss|m|d|h|s)/ig,function(J){switch(J){case"yyyy":return I.getFullYear();case"M":return I.getMonth()+1;case"MM":return B(I.getMonth()+1);case"d":return I.getDate();case"dd":return B(I.getDate());case"H":return I.getHours();case"HH":return B(I.getHours());case"h":return I.getHours()%12;case"hh":return B(I.getHours()%12);case"m":return I.getMinutes();case"mm":return B(I.getMinutes());case"s":return I.getSeconds();case"ss":return B(I.getSeconds());default:return J}});return H};function c(I){if(!I){return document}var H=I.target;if(!H){H=I.srcElement}if(H.nodeType===3){H=H.parentNode}return H||document}function B(H){return("0"+H).slice(-2)}function w(I,H){for(var J in I){if(!H.hasOwnProperty(J)){H[J]=I[J]}}return H}function z(M,I){if(!I){return}M||(M=document.body);var H=I.length,K,L;for(var J=0;J<H;J++){K=I[J];if(typeof K=="string"){M.appendChild(document.createTextNode(K))}else{L=document.createElement(K[0]);if(K[1]){L.className=K[1]}if(K[2]){L.innerHTML=K[2]}M.appendChild(L);I[J]=L}}}function G(K,M,J,I,H){var L=document.createElement(K.toUpperCase());M&&(L.id=M);I&&(L.className=I);H&&(L.innerHTML=H);J||(J=document.body);return J.appendChild(L)}function h(H,J){var I=new Date(H);I.setDate(J);return I.getDay()}function E(H){var J,I=t[H.getMonth()];if(I!=28){return I}J=H.getFullYear();if(J%4==0&&J%100!=0||J%400==0){return 29}return I}function e(J,K,M,L){M=M||(J-11);if(M<0){M=0}var I="<a>&lt;&lt;&lt;</a>";for(var H=M;H<M+23;H++){I+="<a"+(H==J?' class="hover"':"")+">"+H+"</a>"}I+="<a>&gt;&gt;&gt;</a>";y(K,I);F(K.parentNode);K.onclick=function(Q){var P=c(Q||event);if(P&&P.tagName){var N=P.tagName.toLowerCase(),O;if(N=="a"){O=y(P);if(O=="&lt;&lt;&lt;"){e(J,K,M-23,L)}else{if(O=="&gt;&gt;&gt;"){e(J,K,M+23,L)}else{L(O);s(K.parentNode)}}}}}}function b(K,J,L){var I="<div>";for(var H=1;H<=12;H++){I+="<a"+(H==K?' class="hover"':"")+">"+H+"</a>"}y(J,I+"</div>");F(J.parentNode);J.onclick=function(P){var O=c(P||event);if(O&&O.tagName){var M=O.tagName.toLowerCase(),N;if(M=="a"){N=y(O);L(null,N);s(J.parentNode)}}}}function C(M,O,I,N,L){var K="<div>",H="";for(var J=N||0;J<=I;J++){H="";if(J==O){H+="hover "}if(J%2==1){H+="odd "}if(H!=""){H=H.slice(0,-1)}K+="<a"+(H!=""?' class="'+H+'"':"")+">"+J+"</a>"}y(M,K+"</div>");F(M.parentNode)}function y(I,H){if(H===true){return parseInt(I.innerHTML)}if(H!==undefined){I.innerHTML=typeof H=="object"?H.innerHTML:H}return I.innerHTML}function o(I,H){return I.offsetLeft+Math.floor(I.offsetWidth/2)+H}function F(I,H){I.style.display=H||"block"}function s(H){H.style.display="none"}function r(H){return H.getFullYear()+("0"+(H.getMonth()+1)).slice(-2)+("0"+H.getDate()).slice(-2)}function D(H){return H.style.display!="none"}function v(an,I,ab,ak){var Y=0,Q=I.cell_height||0,af=0;if(I.width){af=Math.floor(I.width/7);Y=af*7;I.cell_width=af}var ao="";var ai=G("div",null,an,"calendar-main inline-block"),H=null,Z=null;if(Y>0){ai.style.width=Y+"px"}if(I.has_container!==true){H=G("div",null,ai,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>')}var S=G("div",null,ai,"calendar-header");var P=G("div",null,ai,"calendar-quick");var L=G("div",null,P,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');var X=G("div",null,P,"calendar-quick-contents");var al=G("div",null,P,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');function ag(aq,ap,at,ar){L.style.display=aq;L.style.marginLeft=at;al.style.display=ap;al.style.marginLeft=ar}var ae=G("ul",null,S,"select-box"),W=[["li","area-left"],["li","area-middle"],["li","area-right"],["li","area-left area-month"],["li","area-middle-month"],["li","area-right"]];z(ae,W);var M=W[0],U=W[1],O=W[2],N=W[3],R=W[4],ah=W[5];s(P);M.onclick=function(){var ap=y(U,true);if(ap<=100){return}y(U,ap-1);if(D(P)){e(ap-1,X,null,ab)}ab()};O.onclick=function(){y(U,y(U,true)+1);if(D(P)){e(y(U,true),X,null,ab)}ab()};U.onclick=function(){if(ao!="year"||P.style.display=="none"){e(y(U,true),X,null,ab);ao="year";P.style.marginTop="2px";P.className="calendar-quick";ag("block","none",o(U,-4)+"px","0")}else{s(P)}};N.onclick=function(){var aq=y(R,true),ap=aq-1;if(aq==1){ap=12;y(U,y(U,true)-1)}y(R,ap);if(D(P)){b(ap,X,ab)}ab()};ah.onclick=function(){var aq=y(R,true),ap=aq+1;if(aq==12){ap=1;y(U,y(U,true)+1)}y(R,ap);if(D(P)){b(ap,X,ab)}ab()};R.onclick=function(){if(ao!="month"||P.style.display=="none"){b(y(R,true),X,ab);ao="month";P.style.marginTop="2px";P.className="calendar-quick";ag("block","none",o(R,-4)+"px","0")}else{s(P)}};var V=G("div",null,ai,"calendar-body-wapper");var aj=G("ul",null,V,"calendar-body"),J;for(var ad=0;ad<7;ad++){J=G("li",false,aj,"weeks",I.weeks[ad%7]);if(af>0){J.style.width=af+"px"}}if(I.show_time===true){var T=G("div",null,V,"calendar-time"),aa=[["div","calendar-hours","0"],":",["div","calendar-minutes","0"],":",["div","calendar-seconds","0"]];z(T,aa);var ac=aa[0],am=aa[2],K=aa[4];T.onclick=function(au){var at=c(au||event),ar=at.className,ap=0,av,aq="";if(ar=="calendar-hours"){ap=23;X.onclick=function(ay){var ax=c(ay||event);if(ax&&ax.tagName){var aw=ax.tagName.toLowerCase();if(aw=="a"){y(ac,ax);s(P);ak()}}};ag("none","block","0",o(ac,-4)+"px")}else{if(ar=="calendar-minutes"||ar=="calendar-seconds"){ap=59;X.onclick=function(ay){var ax=c(ay||event);if(ax&&ax.tagName){var aw=ax.tagName.toLowerCase();if(aw=="a"){if(ar=="calendar-minutes"){y(am,ax)}else{if(ar=="calendar-seconds"){y(K,ax)}}s(P);ak()}}};ag("none","block","0",o(ar=="calendar-seconds"?K:am,-4)+"px");aq=" calendar-quick-minorsec"}}if(ap>0){av=y(at,true);if(ao!=ar||P.style.display=="none"){ao=ar;C(X,av,ap);P.className="calendar-quick calendar-quick-time"+aq;P.style.marginTop=(aj.offsetHeight-P.offsetHeight)+"px"}else{s(P)}}}}if(I.has_container!==true){Z=G("div",null,V,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>')}return{year:U,month:R,weeks:aj,main:ai,quick:P,quick_content:X,time:{hours:function(ap){return y(ac,ap)},minutes:function(ap){return y(am,ap)},seconds:function(ap){return y(K,ap)},set:function(ap){y(ac,ap.getHours());y(am,ap.getMinutes());y(K,ap.getSeconds())}},arraw_down:Z,arraw_up:H}}function x(I){var H={x:I.offsetLeft,y:I.offsetTop,h:I.offsetHeight};I=I.offsetParent;while(I){H.x+=I.offsetLeft;H.y+=I.offsetTop;I=I.offsetParent}return H}function u(K,J){F(K.main);var L=x(J),I=L.y+L.h,H=L.x;F(K.arraw_up);s(K.arraw_down);if(I+K.main.offsetHeight>n()+d()){I=L.y-K.main.offsetHeight-5;s(K.arraw_up);F(K.arraw_down)}else{I+=5}K.main.style.cssText="position:absolute; top:"+I+"px; left:"+H+"px;"}function n(){if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}if(window.innerWidth){return window.innerHeight}if(document.body&&document.body.clientWidth){return document.body.clientHeight}return 0}function d(){if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}return(window.pageYOffset||document.body.scrollTop)||0}function m(H){if(H&&H.stopPropagation){H.stopPropagation()}else{window.event.cancelBubble=true}}function q(K,J,I,H){if(K.addEventListener){K.addEventListener(J,I,H!==true)}else{if(K.attachEvent){K.attachEvent("on"+J,I)}else{K["on"+J]=I}}}function i(I,H){var J=I.parentNode;while(J){if(J==H){return true}J=J.parentNode}return false}function l(H){if(typeof H!="string"){return H}var I=/^(\d{4})\-(\d{1,2})\-(\d{1,2})( (\d{1,2})\:(\d{1,2})\:(\d{1,2}))?$/.exec(H);if(!I){return null}if(I[4]){return new Date(parseInt(I[1]),parseInt(I[2])-1,parseInt(I[3]),parseInt(I[5]),parseInt(I[6]),parseInt(I[7]))}return new Date(parseInt(I[1]),parseInt(I[2])-1,parseInt(I[3]))}function g(I,H){I.className=((I.className||"").replace(new RegExp("\\b"+H.replace(/\-/g,"\\-")+"\\b","g"),"")+" "+H).replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function a(I,H){I.className=(I.className||"").replace(new RegExp("\\b"+H.replace(/\-/g,"\\-")+"\\b","g"),"").replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,"")}function f(I,H){return(new RegExp("\\b"+H.replace(/\-/g,"\\-")+"\\b","g")).test((I.className||""))}var k=window.Eson=function(Q,T,L){T=T||{};if(T.multi===true){delete T.multi;return p(Q,T)}var J=function(ad){var ag=U.weeks;N.length=0;while(ag.childNodes.length>7){ag.removeChild(ag.lastChild)}for(var af=0;af<ad;af++){for(var ae=0;ae<7;ae++){N[af*7+ae]=G("li",false,ag,false,"&nbsp;");if(af==ad-1){g(N[af*7+ae],"calendar-last-line")}}}};var S=function(af){if(K.before_render){K.before_render(af)}var ad=h(af,1)-K.first_week_day;if(ad<0){ad=7+ad}var aj=1,an=af.getFullYear(),ag=af.getMonth()+1,am=af.getDate();y(U.year,an);y(U.month,ag);var ap=E(af)+ad,aq=K.lines||Math.ceil(ap/7),ao=aq*7;J(aq);for(var ah=0;ah<ao;ah++){var ai=N[ah],al;ai.isInMonth=false;if(ah<ad||ah>(ap-1)){g(ai,"disabled");if(ah<ad){var ak=(new Date(+af));ak.setDate(ah-ad+1);ai.day=ak.getDate();ai.month=ag-1}else{ai.day=ah-ap+1;ai.month=ag+1}al=new Date(an,ai.month-1,ai.day)}else{al=new Date(an,ag-1,aj);ai.month=ag;ai.day=aj;ai.isInMonth=true;var ae=h(af,aj)%7;if(ae==0||ae==6){g(ai,"sunday")}ai.onmouseover=function(){if(!f(this,"selected")){g(this,"current")}};ai.onmouseout=function(){a(this,"current")};aj++}y(ai,"<div>"+(K.date_up?(K.date_up.call(ai,an,ai.month,ai.day)||ai.day):ai.day)+"</div>");if(W[r(al)]){g(ai,"selected")}al=+al;if(K.min>0&&al<K.min||K.max>0&&al>K.max){a(ai,"selected");a(ai,"sunday");g(ai,"disabled");ai.onmouseout=ai.onmouseover=function(){}}else{ai.onclick=function(){s(U.quick);am=this.day;var av=new Date(an,this.month-1,am),at=[av.getFullYear(),B(av.getMonth()+1),B(av.getDate())];a(this,"current");if(K.multi_select===true){if(f(this,"selected")){a(this,"selected");at.push(false)}else{g(this,"selected");at.push(true)}}else{for(var au=0;au<N.length;au++){a(N[au],"selected")}g(this,"selected");for(var ar in W){if(W.hasOwnProperty(ar)){delete W[ar]}}W[r(av)]=av;if(K.show_time===true){at.push(B(U.time.hours()),B(U.time.minutes()),B(U.time.seconds()))}at.push(this);H=av}if(K.onselect){K.onselect.apply(av,at)}if(K.multi_select!==true&&!this.isInMonth){return S(av)}if(K.remain!==true){s(U.main)}}}}if(K.cell_width||K.cell_height){for(var ah=0;ah<N.length;ah++){if(K.cell_width){N[ah].style.width=K.cell_width+"px";N[ah].childNodes[0].style.width=(K.cell_width-4)+"px"}if(K.cell_height){N[ah].style.height=K.cell_height+"px";N[ah].childNodes[0].style.height=(K.cell_height-4)+"px"}}}if(K.after_render){K.after_render(af)}};var X=function(ad,ae){if(ad){y(U.year,ad)}if(ae){y(U.month,ae)}S(new Date(y(U.year,true),y(U.month,true)-1,1))};var ab=function(af){var ad=[];for(var ae in W){if(W.hasOwnProperty(ae)&&W[ae]){ad.push(A(W[ae],K.format?K.format:"yyyy-MM-dd"))}}if(af){af.call(W,ad)}else{Q.value=ad.join(",")}};var aa=function(ae){ae=ae||H;var ad=[ae.getFullYear(),B(ae.getMonth()+1),B(ae.getDate())];if(K.show_time===true){ad.push(B(U.time.hours()),B(U.time.minutes()),B(U.time.seconds()))}K.onselect.apply(H,ad)};var K={date:null,weeks:"日一二三四五六",onselect:null,first_week_day:0,weeks_count:1,multi_select:false,min:0,max:0},N=[],U=null,W=L||{},H;if(T.min){T.min=+l(T.min)}if(T.max){T.max=+l(T.max)}for(var Z in T){if(!T.hasOwnProperty(Z)){continue}K[Z]=T[Z]}if(typeof K.weeks=="string"){K.weeks=K.weeks.split("")}"string"==typeof(Q)&&(Q=document.getElementById(Q));if(!Q){if(K.onerror){K.onerror("target element error.")}return}var ac=Q.tagName.toLowerCase();if(ac=="input"){if(Q.type!="text"){if(K.onerror){K.onerror("target element error.")}return}}H=K.date;if(!H&&Q.value){H=Q.value}if(K.multi_select===true){var M={},P=0;if(H){var V,Y,O;if(typeof H=="string"){H=H.split(",")}for(var Z=0;Z<H.length;Z++){V=l(H[Z]);Y=r(V);W[Y]=V;O=Y.substr(0,6);if(!M.hasOwnProperty(O)){M[O]=[];P++}M[O].push(V)}if(P>1&&K.multi!==false){K.max_count=K.max_count||0;K.set_up_months=[];for(var Z in M){if(M.hasOwnProperty(Z)){K.set_up_months.push(M[Z][0])}}if(K.max_count>0&&P>K.max_count){P=K.max_count}K.count=P;K.multi=false;return p(Q,K,W)}}else{H=[]}var R=K.onselect;K.onselect=function(ag,ad,af,ae){if(ae){W[ag+ad+af]=this}else{W[ag+ad+af]=null}ab(R)};ab(R);K.remain=true;H=l(H[0]);if(!H){H=new Date()}}else{H=l(H);if(!H){H=new Date()}W[r(H)]=H;if(!K.onselect){K.onselect=function(ai,ah,ag,af,ad,ae){Q.value=K.format?A(this,K.format):(ai+"-"+ah+"-"+ag+(K.show_time===true?(" "+af+":"+ad+":"+ae):""))}}var I=[H.getFullYear(),B(H.getMonth()+1),B(H.getDate())];if(K.show_time===true){I.push(B(H.getHours()),B(H.getMinutes()),B(H.getSeconds()))}K.onselect.apply(H,I)}if(ac=="input"){q(document,"click",function(ae){if(!U||!U.main){return}var ad=c(ae||event);if(Q==ad||U.main==ad||i(ad,U.main)){return}s(U.main)});q(Q,"focus",function(ad){u(U,Q)});U=v(null,K,X,aa);s(U.main)}else{if(ac=="div"){K.remain=true;U=v(Q,K,X,aa)}else{q(document,"click",function(ae){if(!U||!U.main){return}var ad=c(ae||event);if(U.main==ad||i(ad,U.main)){return}s(U.main)});q(Q,"click",function(ad){m(ad);u(U,K.bindto||Q)});U=v(null,K,X,aa);s(U.main)}}j++;if(K.multi_select===true){q(U.weeks,"click",function(ah){var ai=c(ah||event),ag=-1,ae=ai.className;if(f(ai,"weeks")){var ak=U.weeks.getElementsByTagName("li"),aj,al,ad;for(var af=0;af<ak.length;af++){if(ai==ak[af]){ag=af}else{if(ag>=0&&af%7==ag){aj=new Date(y(U.year,true),ak[af].month-1,ak[af].day);ad=r(aj);if(W[ad]){W[ad]=null}else{W[ad]=aj}if(ak[af].isInMonth){al=aj}}}}if(al){S(al)}ab(R);if(f(ai,"checked")){a(ai,"checked")}else{g(ai,"checked")}}})}if(K.set_up_date){H=l(K.set_up_date)||H}S(H);if(K.show_time===true){U.time.set(H)}return{options:K,controls:U,date_up:S}};k.format=A;k.on=q;k.cancel_bubble=m;k.child_of=i;var p=function(H,K,L){function M(){var T=G("div",null,null,"calendar-group inline-block"),V,R,Q;Q=G("div",null,T,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');for(var S=0;S<P.count;S++){if(P.set_up_months){V=P.set_up_months[S]}k(T,w(P,{set_up_date:V||new Date(),has_container:true}),L)}if(P.show_close!==false){var U=G("div",null,T,"calendar-close","x");U.onclick=function(){s(T)}}R=G("div",null,T,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');return{main:T,arraw_up:Q,arraw_down:R}}var P={date:[],onselect:null,count:2},N=null,I=[];for(var J in K){if(!K.hasOwnProperty(J)){continue}P[J]=K[J]}P.remain=true;P.lines=6;if(!P.onselect){P.onselect=function(Q){H.value=Q.join(",")}}"string"==typeof(H)&&(H=document.getElementById(H));if(!H){if(P.onerror){P.onerror("target element error.")}return}var O=H.tagName.toLowerCase();if(O=="input"){if(H.type!="text"){if(P.onerror){P.onerror("target element error.")}return}q(document,"click",function(R){if(!N||!N.main){return}var Q=c(R||event);if(H==Q||N.main==Q||i(Q,N.main)){return}s(N.main)});q(H,"focus",function(){u(N,H)});N=M();s(N.main)}else{if(O=="div"){N=M();H.appendChild(N.main)}else{q(document,"click",function(R){if(!N||!N.main){return}var Q=c(R||event);if(N.main==Q||i(Q,N.main)){return}s(N.main)});q(H,"click",function(Q){m(Q);u(N,H)});N=M();s(N.main)}}return{options:P,controls:N}}})();