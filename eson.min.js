/*!
Eson Date input control
first create by 'UANV,ESONCalendar and so on'
modify by anlige @ www.thinkasp.cn
last modify at 2015-10-26
*/
(function(){var e=0;var n=function(u,t){u=u||(new Date());t=t.replace(/(yyyy|mmmm|mmm|mm|dddd|ddd|fff|ff|f|dd|hh|ss|m|d|h|s)/ig,function(v){switch(v){case"yyyy":return u.getFullYear();case"M":return u.getMonth()+1;case"MM":return o(u.getMonth()+1);case"d":return u.getDate();case"dd":return o(u.getDate());case"H":return u.getHours();case"HH":return o(u.getHours());case"h":return u.getHours()%12;case"hh":return o(u.getHours()%12);case"m":return u.getMinutes();case"mm":return o(u.getMinutes());case"s":return u.getSeconds();case"ss":return o(u.getSeconds());default:return v}});return t};function o(t){return("0"+t).slice(-2)}function r(u,t){for(var v in t){if(t.hasOwnProperty(v)){u[v]=t[v]}}return u}function k(u,t){for(var v in u){if(!t.hasOwnProperty(v)){t[v]=u[v]}}return t}function s(w,y,v,u,t){var x=document.createElement(w.toUpperCase());y&&(x.id=y);u&&(x.className=u);t&&(x.innerHTML=t);v||(v=document.body);return v.appendChild(x)}function c(t,v,w){var u=new Date(t);u.setDate(v);return u.getDay()+(w||0)}function q(w){var x=w.getFullYear(),t=w.getMonth()+1,v=31;var u=(x%4==0&&x%4!=100||x%100==0&&x%400==0);if(/-4|-6|-9|-11/.test("-"+t)){v=30}if(t==2){v=u?29:28}return v}function b(u,w,y,x){var v;y=y||(u-11);if(y<0){y=0}m(w,"");v=s("a",null,w,false,"&lt;&lt;&lt;");for(var t=y;t<y+23;t++){v=s("a",null,w,t==u?"hover":"",t)}v=s("a",null,w,false,"&gt;&gt;&gt;");w.onclick=function(C){var B=(event.srcElement||C.target);if(B&&B.tagName){var z=B.tagName.toLowerCase(),A;if(z=="a"){A=m(B);if(A=="&lt;&lt;&lt;"){b(u,w,y-23,x)}else{if(A=="&gt;&gt;&gt;"){b(u,w,y+23,x)}else{x(A);w.parentNode.style.display="none"}}}}}}function a(w,v,x){var u="<div>";for(var t=1;t<=12;t++){u+="<a"+(t==w?' class="hover"':"")+">"+t+"</a>"}m(v,u+"</div>");v.onclick=function(B){var A=(event.srcElement||B.target);if(A&&A.tagName){var y=A.tagName.toLowerCase(),z;if(y=="a"){z=m(A);x(null,z);v.parentNode.style.display="none"}}}}function p(x,z,t,y,w){m(x,"");var v="<div>";for(var u=y||0;u<=t;u++){if((t==59&&u%5==0)||t==23||w===true){v+="<a"+(u==z?' class="hover"':"")+">"+u+"</a>"}}m(x,v+"</div>")}function m(u,t){if(t===true){return parseInt(u.innerHTML)}if(t!==undefined){u.innerHTML=t}return u.innerHTML}function j(T,t,I,Q){var U="";var O=s("div",null,T,"calendar-main inline-block");var D=s("div",null,O,"calendar-header");var B=s("div",null,O,"calendar-quick");var v=s("div",null,B,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');var H=s("div",null,B,"calendar-quick-contents");var R=s("div",null,B,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');var M=s("ul",null,D,"select-box");var w=s("li",null,M,"area-left");var G=s("li",null,M,"area-middle");var z=s("li",null,M,"area-right");var x=s("li",null,M,"area-left area-month");var E=s("li",null,M,"area-middle area-month");var N=s("li",null,M,"area-right area-month");B.style.display="none";function L(W,V,Y,X){v.style.display=W;v.style.marginLeft=Y;R.style.display=V;R.style.marginLeft=X}w.onclick=function(){var V=m(G,true);if(V<=0){return}m(G,V-1);if(B.style.display!="none"){b(m(G,true),H,null,I)}I()};z.onclick=function(){m(G,m(G,true)+1);if(B.style.display!="none"){b(m(G,true),H,null,I)}I()};G.onclick=function(){if(U!="year"||B.style.display=="none"){b(m(G,true),H,null,I);B.style.display="block";U="year";B.style.marginTop="0px";B.className="calendar-quick";L("block","none","70px","0")}else{B.style.display="none"}};x.onclick=function(){var V=m(E,true);if(V==1){m(E,12);m(G,m(G,true)-1)}else{m(E,V-1)}if(B.style.display!="none"){a(m(E,true),H,I)}I()};N.onclick=function(){var V=m(E,true);if(V==12){m(E,1);m(G,m(G,true)+1)}else{m(E,V+1)}if(B.style.display!="none"){a(m(E,true),H,I)}I()};E.onclick=function(){if(U!="month"||B.style.display=="none"){a(m(E,true),H,I);B.style.display="block";U="month";B.style.marginTop="0px";B.className="calendar-quick";L("block","none","140px","0")}else{B.style.display="none"}};var P=s("ul",null,O,"calendar-body");for(var K=0;K<7;K++){s("li",false,P,"weeks",t.weeks[K%7])}if(t.show_time===true){var F=s("div",null,O,"calendar-time",'<div class="calendar-hours">23</div>:<div class="calendar-minutes">10</div>:<div class="calendar-seconds">12</div>'),J,S,u;var A=F.getElementsByTagName("div"),C,y;for(var K=0;K<A.length;K++){C=A[K];y=C.className;if(y=="calendar-hours"){J=C}else{if(y=="calendar-minutes"){S=C}else{if(y=="calendar-seconds"){u=C}}}}F.onclick=function(ab){var aa=ab?ab.target:event.srcElement,Z=aa.className,W=0,ac;if(Z=="calendar-hours"){ac=m(aa,true);W=23;H.onclick=function(ag){var ad=ag?ag.target:event.srcElement;if(ad&&ad.tagName){var ae=ad.tagName.toLowerCase(),af;if(ae=="a"){m(J,m(ad));H.parentNode.style.display="none";Q()}}};L("none","block","0","15px")}else{if(Z=="calendar-minutes"||Z=="calendar-seconds"){ac=m(aa,true);W=59;function Y(ag){var af=ag?ag.target:event.srcElement;if(af&&af.tagName){var ad=af.tagName.toLowerCase(),ae;if(ad=="a"){if(m(af)=="&lt;&lt;&lt;"){p(H,ac,59);H.onclick=V;B.style.marginTop=(P.offsetHeight-B.offsetHeight)+"px"}else{if(Z=="calendar-minutes"){m(S,m(af))}else{if(Z=="calendar-seconds"){m(u,m(af))}}B.style.display="none";Q()}}}}function V(ag){var af=ag?ag.target:event.srcElement;if(af&&af.tagName){var ad=af.tagName.toLowerCase(),ae;if(ad=="a"){var ah=m(af,true);p(H,ac,ah+4,ah,true);s("a",null,H.getElementsByTagName("div")[0],null,"&lt;&lt;&lt;");B.style.marginTop=(P.offsetHeight-B.offsetHeight)+"px";H.onclick=Y}}}H.onclick=V;var X="54px";if(Z=="calendar-seconds"){X="94px"}L("none","block","0",X)}}if(W>0){if(U!=Z||B.style.display=="none"){U=Z;m(H,"");p(H,ac,W);B.style.display="block";B.className="calendar-quick calendar-quick-time";B.style.marginTop=(P.offsetHeight-B.offsetHeight)+"px"}else{B.style.display="none"}}}}return{last_year:w,year:G,next_year:z,last_month:x,month:E,next_month:N,weeks:P,main:O,header:D,quick:B,quick_content:H,time:{hours:function(V){return m(J,V)},minutes:function(V){return m(S,V)},seconds:function(V){return m(u,V)}}}}function l(u){var t={x:u.offsetLeft,y:u.offsetTop,width:u.offsetWidth,height:u.offsetHeight};u=u.offsetParent;while(u){t.x+=u.offsetLeft;t.y+=u.offsetTop;u=u.offsetParent}return t}function h(t){if(t&&t.stopPropagation){t.stopPropagation()}else{window.event.cancelBubble=true}}function i(w,v,u,t){if(w.addEventListener){w.addEventListener(v,u,t!==true);return}if(w.attachEvent){w.attachEvent("on"+v,u);return}w["on"+v]=u}function d(u,t){var v=u.parentNode;while(v){if(v==t){return true}v=v.parentNode}return false}function g(u){if(typeof u=="string"){var v=/^(\d{4})\-(\d{1,2})\-(\d{1,2})( (\d{1,2})\:(\d{1,2})\:(\d{1,2}))?$/.exec(u);if(v){var t=new Date(parseInt(v[1]),parseInt(v[2])-1,parseInt(v[3]));if(v[4]){t.setHours(parseInt(v[5]));t.setMinutes(parseInt(v[6]));t.setSeconds(parseInt(v[7]))}u=t}else{u=new Date()}}return u}var f=window.Eson=function(B,E,w){_index=0;E=E||{};if(E.multi===true){delete E.multi;return f.Multi(B,E)}var u=function(O){var R=F.weeks;y.length=0;while(R.childNodes.length>7){R.removeChild(R.lastChild)}for(var Q=0;Q<O;Q++){for(var P=0;P<7;P++){y[Q*7+P]=s("li",false,R,false,"&nbsp;")}}};var D=function(Q,aa){var O=c(Q,1)-v.first_week_day;if(O<0){O=7+O}var U=1,Y=Q.getFullYear(),R=Q.getMonth()+1,X=Q.getDate();m(F.year,Y);m(F.month,R);var ab=q(Q)+O,ac=v.lines||Math.ceil(ab/7),Z=ac*7;u(ac);for(var S=0;S<Z;S++){var T=y[S],W=null,V;T.isSunday=T.className=T.isInMonth=T.onmouseover=T.onmouseout=T.onclick=null;if(S<O||S>(ab-1)){if(S<O){W=(new Date(+Q));W.setDate(S-O+1);T.day=W.getDate();m(T,"<div>"+T.day+"</div>");T.month=R-1}else{T.day=S-ab+1;m(T,"<div>"+T.day+"</div>");T.month=R+1}T.isInMonth=false;T.className="disabled";V=new Date(Y,T.month-1,T.day);if(G[n(V,"yyyyMMdd")]){T.className="selected"}}else{T.month=R;T.day=U;m(T,"<div>"+(v.date_up?(v.date_up(Y,R,U)||U):U)+"</div>");T.className="unselected";T.isInMonth=true;var P=c(Q,U)%7;if(P==0||P==6){T.className="sunday";T.isSunday=true}if(G[Y+o(R)+o(U)]){T.className="selected"}T.onmouseover=function(){if(this.className!="selected"){this.className="current"}};T.onmouseout=function(){if(this.className!="selected"){this.className=this.isSunday?"sunday":"unselected"}};U++}T.onclick=function(){X=this.day;var ag;if(this.month!=R){ag=new Date(Q.getFullYear(),this.month-1,X);D(ag,true);return}ag=new Date(Q);ag.setDate(X);if(v.multi_select===true){if(this.className=="selected"){if(this.isSunday){this.className="sunday"}else{this.className="unselected"}if(v.onselect){v.onselect.call(ag,Y,o(R),o(X),_index,false)}}else{this.className="selected";if(v.onselect){v.onselect.call(ag,Y,o(R),o(X),_index,true)}}}else{for(var af=0;af<y.length;af++){var ah=y[af];if(ah.isInMonth){ah.className="unselected"}if(ah.isSunday){ah.className="sunday"}}this.className="selected";for(var ae in G){if(G.hasOwnProperty(ae)){delete G[ae]}}G[Y+o(R)+o(X)]=ag;var ad=[Y,o(R),o(X)];if(v.show_time===true){ad.push(o(F.time.hours()),o(F.time.minutes()),o(F.time.seconds()))}ad.push(_index);v.date=ag;if(v.onselect){v.onselect.apply(ag,ad)}}if(v.remain!==true){F.main.style.display="none"}}}};var I=function(O,P){if(O){m(F.year,O)}if(P){m(F.month,P)}D(new Date(m(F.year,true),m(F.month,true)-1,1))};var M=function(Q){var O=[];for(var P in G){if(G.hasOwnProperty(P)&&G[P]){O.push(n(G[P],v.format?v.format:"yyyy-MM-dd"))}}if(Q){Q.call(G,O)}else{B.value=O.join(",")}};var L=function(P){P=P||v.date;var O=[P.getFullYear(),o(P.getMonth()+1),o(P.getDate())];if(v.show_time===true){O.push(o(F.time.hours()),o(F.time.minutes()),o(F.time.seconds()))}O.push(_index);v.onselect.apply(v.date,O)};var v={date:null,weeks:"日一二三四五六",onselect:null,first_week_day:0,weeks_count:1,multi_select:false},y=[],F=null,G=w||{};for(var K in E){if(!E.hasOwnProperty(K)){continue}v[K]=E[K]}if(typeof v.weeks=="string"){v.weeks=v.weeks.split("")}"string"==typeof(B)&&(B=document.getElementById(B));if(!B){if(v.onerror){v.onerror("target element error.")}return}var N=B.tagName.toLowerCase();if(N=="input"){if(B.type!="text"){if(v.onerror){v.onerror("target element error.")}return}}if(!v.date&&B.value){v.date=B.value}if(v.multi_select===true){var x={},A=0;if(v.date){var H,J,z;if(typeof v.date=="string"){v.date=v.date.split(",")}for(var K=0;K<v.date.length;K++){H=g(v.date[K]);J=n(H,"yyyyMMdd");G[J]=H;z=J.substr(0,6);if(!x.hasOwnProperty(z)){x[z]=[];A++}x[z].push(H)}if(A>1&&v.multi!==false){v.max_count=v.max_count||0;v.set_up_months=[];for(var K in x){if(x.hasOwnProperty(K)){v.set_up_months.push(x[K][0])}}if(v.max_count>0&&A>v.max_count){A=v.max_count}v.count=A;v.multi=false;return f.Multi(B,v,G)}}var C=v.onselect;v.onselect=function(S,O,R,P,Q){if(Q){G[S+O+R]=this}else{G[S+O+R]=null}M(C)};M(C);v.remain=true;v.date=g(v.date[0]);if(!v.date){v.date=new Date()}}else{v.date=g(v.date);if(!v.date){v.date=new Date()}G[n(v.date,"yyyyMMdd")]=v.date;if(!v.onselect){v.onselect=function(T,S,R,Q,O,P){B.value=v.format?n(this,v.format):(T+"-"+S+"-"+R+(v.show_time===true?(" "+Q+":"+O+":"+P):""))}}var t=[v.date.getFullYear(),o(v.date.getMonth()+1),o(v.date.getDate())];if(v.show_time===true){t.push(o(v.date.getHours()),o(v.date.getMinutes()),o(v.date.getSeconds()))}t.push(_index);v.onselect.apply(v.date,t)}if(N=="input"){i(document,"click",function(P){if(!F||!F.main){return}var O=(P.target||event.srcElement);if(B==O||F.main==O||d(O,F.main)){return}F.main.style.display="none"});i(B,"focus",function(O){var P=l(B);F.main.style.cssText="position:absolute; display:block; top:"+(P.y+P.height)+"px; left:"+P.x+"px;"});F=j(null,v,I,L);F.main.style.display="none"}else{if(N=="div"){v.remain=true;F=j(B,v,I,L)}else{i(document,"click",function(P){if(!F||!F.main){return}var O=(P.target||event.srcElement);if(F.main==O||d(O,F.main)){return}F.main.style.display="none"});i(B,"click",function(O){h(O);var P=l(B);F.main.style.cssText="position:absolute; display:block; top:"+(P.y+P.height)+"px; left:"+P.x+"px;"});F=j(null,v,I,L);F.main.style.display="none"}}e++;if(v.multi_select===true){i(F.weeks,"click",function(S){var T=S?S.target:event.srcElement,R=-1,P=T.className;if(P.indexOf("weeks")>=0){var V=F.weeks.getElementsByTagName("li"),U,W,O;for(var Q=0;Q<V.length;Q++){if(T==V[Q]){R=Q}else{if(R>=0&&Q%7==R){U=new Date(m(F.year,true),V[Q].month-1,V[Q].day);O=n(U,"yyyyMMdd");if(G[O]){G[O]=null}else{G[O]=U}if(V[Q].isInMonth){W=U}}}}if(W){D(W)}M(C);if(P=="weeks"){T.className="weeks checked"}else{T.className="weeks"}}})}if(v.set_up_date){v.date=g(v.set_up_date)||v.date}D(v.date);if(v.show_time===true){F.time.hours(v.date.getHours());F.time.minutes(v.date.getMinutes());F.time.seconds(v.date.getSeconds())}return{options:v,controls:F,date_up:D}};f.format=n;f.Multi=function(t,w,x){function y(){var D=s("div",null,null,"calendar-group inline-block"),F;for(var C=0;C<B.count;C++){if(B.set_up_months){F=B.set_up_months[C]}f(D,k(B,{set_up_date:F||new Date()}),x)}if(B.show_close!==false){var E=s("div",null,D,"calendar-close","x");E.onclick=function(){D.style.display="none"}}return{main:D}}var B={date:[],onselect:null,count:2},z=null,u=[];for(var v in w){if(!w.hasOwnProperty(v)){continue}B[v]=w[v]}B.remain=true;B.lines=6;if(!B.onselect){B.onselect=function(C){t.value=C.join(",")}}"string"==typeof(t)&&(t=document.getElementById(t));if(!t){if(B.onerror){B.onerror("target element error.")}return}var A=t.tagName.toLowerCase();if(A=="input"){if(t.type!="text"){if(B.onerror){B.onerror("target element error.")}return}i(document,"click",function(D){if(!z||!z.main){return}var C=(D.target||event.srcElement);if(t==C||z.main==C||d(C,z.main)){return}z.main.style.display="none"});i(t,"focus",function(C){var D=l(t);z.main.style.cssText="position:absolute; display:block; top:"+(D.y+D.height)+"px; left:"+D.x+"px;"});z=y();z.main.style.display="none"}else{if(A=="div"){z=y();t.appendChild(z.main)}else{i(document,"click",function(D){if(!z||!z.main){return}var C=(D.target||event.srcElement);if(z.main==C||d(C,z.main)){return}z.main.style.display="none"});i(t,"click",function(C){h(C);var D=l(t);z.main.style.cssText="position:absolute; display:block; top:"+(D.y+D.height)+"px; left:"+D.x+"px;"});z=y();z.main.style.display="none"}}return{options:B,controls:z}}})();