/*!
Eson Date input control
first create by 'UANV,ESONCalendar and so on'
modify by anlige @ www.thinkasp.cn
last modify at 2015-10-26
*/
(function(){var f=0;var q=function(y,x){y=y||(new Date());x=x.replace(/(yyyy|mmmm|mmm|mm|dddd|ddd|fff|ff|f|dd|hh|ss|m|d|h|s)/ig,function(z){switch(z){case"yyyy":return y.getFullYear();case"M":return y.getMonth()+1;case"MM":return r(y.getMonth()+1);case"d":return y.getDate();case"dd":return r(y.getDate());case"H":return y.getHours();case"HH":return r(y.getHours());case"h":return y.getHours()%12;case"hh":return r(y.getHours()%12);case"m":return y.getMinutes();case"mm":return r(y.getMinutes());case"s":return y.getSeconds();case"ss":return r(y.getSeconds());default:return z}});return x};function r(x){return("0"+x).slice(-2)}function u(y,x){for(var z in x){if(x.hasOwnProperty(z)){y[z]=x[z]}}return y}function n(y,x){for(var z in y){if(!x.hasOwnProperty(z)){x[z]=y[z]}}return x}function w(A,C,z,y,x){var B=document.createElement(A.toUpperCase());C&&(B.id=C);y&&(B.className=y);x&&(B.innerHTML=x);z||(z=document.body);return z.appendChild(B)}function d(x,z,A){var y=new Date(x);y.setDate(z);return y.getDay()+(A||0)}function t(B){var C=B.getFullYear(),x=B.getMonth()+1,A=31;var z=(C%4==0&&C%4!=100||C%100==0&&C%400==0);if(/-4|-6|-9|-11/.test("-"+x)){A=30}if(x==2){A=z?29:28}return A}function c(y,A,C,B){var z;C=C||(y-11);if(C<0){C=0}p(A,"");z=w("a",null,A,false,"&lt;&lt;&lt;");for(var x=C;x<C+23;x++){z=w("a",null,A,x==y?"hover":"",x)}z=w("a",null,A,false,"&gt;&gt;&gt;");A.onclick=function(G){var F=(event.srcElement||G.target);if(F&&F.tagName){var D=F.tagName.toLowerCase(),E;if(D=="a"){E=p(F);if(E=="&lt;&lt;&lt;"){c(y,A,C-23,B)}else{if(E=="&gt;&gt;&gt;"){c(y,A,C+23,B)}else{B(E);A.parentNode.style.display="none"}}}}}}function a(A,z,B){var y="<div>";for(var x=1;x<=12;x++){y+="<a"+(x==A?' class="hover"':"")+">"+x+"</a>"}p(z,y+"</div>");z.onclick=function(F){var E=(event.srcElement||F.target);if(E&&E.tagName){var C=E.tagName.toLowerCase(),D;if(C=="a"){D=p(E);B(null,D);z.parentNode.style.display="none"}}}}function s(B,D,x,C,A){p(B,"");var z="<div>";for(var y=C||0;y<=x;y++){if((x==59&&y%5==0)||x==23||A===true){z+="<a"+(y==D?' class="hover"':"")+">"+y+"</a>"}}p(B,z+"</div>")}function p(y,x){if(x===true){return parseInt(y.innerHTML)}if(x!==undefined){y.innerHTML=x}return y.innerHTML}function m(Z,y,O,W){var aa="";var U=w("div",null,Z,"calendar-main inline-block"),x=null,N=null;if(y.has_container!==true){x=w("div",null,U,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>')}var J=w("div",null,U,"calendar-header");var G=w("div",null,U,"calendar-quick");var A=w("div",null,G,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');var M=w("div",null,G,"calendar-quick-contents");var X=w("div",null,G,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');var S=w("ul",null,J,"select-box");var B=w("li",null,S,"area-left");var L=w("li",null,S,"area-middle");var E=w("li",null,S,"area-right");var C=w("li",null,S,"area-left area-month");var I=w("li",null,S,"area-middle-month");var T=w("li",null,S,"area-right");G.style.display="none";function R(ac,ab,ae,ad){A.style.display=ac;A.style.marginLeft=ae;X.style.display=ab;X.style.marginLeft=ad}B.onclick=function(){var ab=p(L,true);if(ab<=0){return}p(L,ab-1);if(G.style.display!="none"){c(p(L,true),M,null,O)}O()};E.onclick=function(){p(L,p(L,true)+1);if(G.style.display!="none"){c(p(L,true),M,null,O)}O()};L.onclick=function(){if(aa!="year"||G.style.display=="none"){c(p(L,true),M,null,O);G.style.display="block";aa="year";G.style.marginTop="0px";G.className="calendar-quick";R("block","none","70px","0")}else{G.style.display="none"}};C.onclick=function(){var ab=p(I,true);if(ab==1){p(I,12);p(L,p(L,true)-1)}else{p(I,ab-1)}if(G.style.display!="none"){a(p(I,true),M,O)}O()};T.onclick=function(){var ab=p(I,true);if(ab==12){p(I,1);p(L,p(L,true)+1)}else{p(I,ab+1)}if(G.style.display!="none"){a(p(I,true),M,O)}O()};I.onclick=function(){if(aa!="month"||G.style.display=="none"){a(p(I,true),M,O);G.style.display="block";aa="month";G.style.marginTop="0px";G.className="calendar-quick";R("block","none","140px","0")}else{G.style.display="none"}};var V=w("ul",null,U,"calendar-body");for(var Q=0;Q<7;Q++){w("li",false,V,"weeks",y.weeks[Q%7])}if(y.show_time===true){var K=w("div",null,U,"calendar-time",'<div class="calendar-hours">23</div>:<div class="calendar-minutes">10</div>:<div class="calendar-seconds">12</div>'),P,Y,z;var F=K.getElementsByTagName("div"),H,D;for(var Q=0;Q<F.length;Q++){H=F[Q];D=H.className;if(D=="calendar-hours"){P=H}else{if(D=="calendar-minutes"){Y=H}else{if(D=="calendar-seconds"){z=H}}}}K.onclick=function(ah){var ag=ah?ah.target:event.srcElement,af=ag.className,ac=0,ai;if(af=="calendar-hours"){ai=p(ag,true);ac=23;M.onclick=function(al){var aj=al?al.target:event.srcElement;if(aj&&aj.tagName){var ak=aj.tagName.toLowerCase();if(ak=="a"){p(P,p(aj));M.parentNode.style.display="none";W()}}};R("none","block","0","15px")}else{if(af=="calendar-minutes"||af=="calendar-seconds"){ai=p(ag,true);ac=59;function ae(al){var ak=al?al.target:event.srcElement;if(ak&&ak.tagName){var aj=ak.tagName.toLowerCase();if(aj=="a"){if(p(ak)=="&lt;&lt;&lt;"){s(M,ai,59);M.onclick=ab;G.style.marginTop=(V.offsetHeight-G.offsetHeight)+"px"}else{if(af=="calendar-minutes"){p(Y,p(ak))}else{if(af=="calendar-seconds"){p(z,p(ak))}}G.style.display="none";W()}}}}function ab(al){var ak=al?al.target:event.srcElement;if(ak&&ak.tagName){var aj=ak.tagName.toLowerCase();if(aj=="a"){var am=p(ak,true);s(M,ai,am+4,am,true);w("a",null,M.getElementsByTagName("div")[0],null,"&lt;&lt;&lt;");G.style.marginTop=(V.offsetHeight-G.offsetHeight)+"px";M.onclick=ae}}}M.onclick=ab;var ad="54px";if(af=="calendar-seconds"){ad="94px"}R("none","block","0",ad)}}if(ac>0){if(aa!=af||G.style.display=="none"){aa=af;p(M,"");s(M,ai,ac);G.style.display="block";G.className="calendar-quick calendar-quick-time";G.style.marginTop=(V.offsetHeight-G.offsetHeight)+"px"}else{G.style.display="none"}}}}if(y.has_container!==true){N=w("div",null,U,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>')}return{last_year:B,year:L,next_year:E,last_month:C,month:I,next_month:T,weeks:V,main:U,header:J,quick:G,quick_content:M,time:{hours:function(ab){return p(P,ab)},minutes:function(ab){return p(Y,ab)},seconds:function(ab){return p(z,ab)}},arraw_down:N,arraw_up:x}}function o(y){var x={x:y.offsetLeft,y:y.offsetTop,width:y.offsetWidth,height:y.offsetHeight};y=y.offsetParent;while(y){x.x+=y.offsetLeft;x.y+=y.offsetTop;y=y.offsetParent}return x}function l(A,z){A.main.style.display="block";var B=o(z),y=B.y+B.height,x=B.x;A.arraw_up.style.display="block";A.arraw_down.style.display="none";if(y+A.main.offsetHeight>j()+b()){y=B.y-A.main.offsetHeight-5;A.arraw_up.style.display="none";A.arraw_down.style.display="block"}else{y+=5}A.main.style.cssText="position:absolute; top:"+y+"px; left:"+x+"px;"}function j(){if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}if(window.innerWidth){return window.innerHeight}if(document.body&&document.body.clientWidth){return document.body.clientHeight}return 0}function b(){if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}return(window.pageYOffset||document.body.scrollTop)||0}function v(A,z){var y=[],x=2;if(typeof A=="function"){z=A;A=null;x=1}if(arguments.length>x){y=Array.prototype.slice.call(arguments,x)}return function(){z.apply(A,y)}}function i(x){if(x&&x.stopPropagation){x.stopPropagation()}else{window.event.cancelBubble=true}}function k(A,z,y,x){if(A.addEventListener){A.addEventListener(z,y,x!==true);return}if(A.attachEvent){A.attachEvent("on"+z,y);return}A["on"+z]=y}function e(y,x){var z=y.parentNode;while(z){if(z==x){return true}z=z.parentNode}return false}function h(y){if(typeof y=="string"){var z=/^(\d{4})\-(\d{1,2})\-(\d{1,2})( (\d{1,2})\:(\d{1,2})\:(\d{1,2}))?$/.exec(y);if(z){var x=new Date(parseInt(z[1]),parseInt(z[2])-1,parseInt(z[3]));if(z[4]){x.setHours(parseInt(z[5]));x.setMinutes(parseInt(z[6]));x.setSeconds(parseInt(z[7]))}y=x}else{y=new Date()}}return y}var g=window.Eson=function(F,I,A){_index=0;I=I||{};if(I.multi===true){delete I.multi;return g.Multi(F,I)}var y=function(S){var V=J.weeks;C.length=0;while(V.childNodes.length>7){V.removeChild(V.lastChild)}for(var U=0;U<S;U++){for(var T=0;T<7;T++){C[U*7+T]=w("li",false,V,false,"&nbsp;")}}};var H=function(U,ae){var S=d(U,1)-z.first_week_day;if(S<0){S=7+S}var Y=1,ac=U.getFullYear(),V=U.getMonth()+1,ab=U.getDate();p(J.year,ac);p(J.month,V);var af=t(U)+S,ag=z.lines||Math.ceil(af/7),ad=ag*7;y(ag);for(var W=0;W<ad;W++){var X=C[W],aa=null,Z;X.isSunday=X.className=X.isInMonth=X.onmouseover=X.onmouseout=X.onclick=null;if(W<S||W>(af-1)){if(W<S){aa=(new Date(+U));aa.setDate(W-S+1);X.day=aa.getDate();p(X,"<div>"+X.day+"</div>");X.month=V-1}else{X.day=W-af+1;p(X,"<div>"+X.day+"</div>");X.month=V+1}X.isInMonth=false;X.className="disabled";Z=new Date(ac,X.month-1,X.day);if(K[q(Z,"yyyyMMdd")]){X.className="selected"}}else{X.month=V;X.day=Y;p(X,"<div>"+(z.date_up?(z.date_up(ac,V,Y)||Y):Y)+"</div>");X.className="unselected";X.isInMonth=true;var T=d(U,Y)%7;if(T==0||T==6){X.className="sunday";X.isSunday=true}if(K[ac+r(V)+r(Y)]){X.className="selected"}X.onmouseover=function(){if(this.className!="selected"){this.className="current"}};X.onmouseout=function(){if(this.className!="selected"){this.className=this.isSunday?"sunday":"unselected"}};Y++}X.onclick=function(){ab=this.day;var ak;if(this.month!=V){ak=new Date(U.getFullYear(),this.month-1,ab);H(ak,true);return}ak=new Date(U);ak.setDate(ab);if(z.multi_select===true){if(this.className=="selected"){if(this.isSunday){this.className="sunday"}else{this.className="unselected"}if(z.onselect){z.onselect.call(ak,ac,r(V),r(ab),_index,false)}}else{this.className="selected";if(z.onselect){z.onselect.call(ak,ac,r(V),r(ab),_index,true)}}}else{for(var aj=0;aj<C.length;aj++){var al=C[aj];if(al.isInMonth){al.className="unselected"}if(al.isSunday){al.className="sunday"}}this.className="selected";for(var ai in K){if(K.hasOwnProperty(ai)){delete K[ai]}}K[ac+r(V)+r(ab)]=ak;var ah=[ac,r(V),r(ab)];if(z.show_time===true){ah.push(r(J.time.hours()),r(J.time.minutes()),r(J.time.seconds()))}ah.push(_index);z.date=ak;if(z.onselect){z.onselect.apply(ak,ah)}}if(z.remain!==true){J.main.style.display="none"}}}};var M=function(S,T){if(S){p(J.year,S)}if(T){p(J.month,T)}H(new Date(p(J.year,true),p(J.month,true)-1,1))};var Q=function(U){var S=[];for(var T in K){if(K.hasOwnProperty(T)&&K[T]){S.push(q(K[T],z.format?z.format:"yyyy-MM-dd"))}}if(U){U.call(K,S)}else{F.value=S.join(",")}};var P=function(T){T=T||z.date;var S=[T.getFullYear(),r(T.getMonth()+1),r(T.getDate())];if(z.show_time===true){S.push(r(J.time.hours()),r(J.time.minutes()),r(J.time.seconds()))}S.push(_index);z.onselect.apply(z.date,S)};var z={date:null,weeks:"日一二三四五六",onselect:null,first_week_day:0,weeks_count:1,multi_select:false},C=[],J=null,K=A||{};for(var O in I){if(!I.hasOwnProperty(O)){continue}z[O]=I[O]}if(typeof z.weeks=="string"){z.weeks=z.weeks.split("")}"string"==typeof(F)&&(F=document.getElementById(F));if(!F){if(z.onerror){z.onerror("target element error.")}return}var R=F.tagName.toLowerCase();if(R=="input"){if(F.type!="text"){if(z.onerror){z.onerror("target element error.")}return}}if(!z.date&&F.value){z.date=F.value}if(z.multi_select===true){var B={},E=0;if(z.date){var L,N,D;if(typeof z.date=="string"){z.date=z.date.split(",")}for(var O=0;O<z.date.length;O++){L=h(z.date[O]);N=q(L,"yyyyMMdd");K[N]=L;D=N.substr(0,6);if(!B.hasOwnProperty(D)){B[D]=[];E++}B[D].push(L)}if(E>1&&z.multi!==false){z.max_count=z.max_count||0;z.set_up_months=[];for(var O in B){if(B.hasOwnProperty(O)){z.set_up_months.push(B[O][0])}}if(z.max_count>0&&E>z.max_count){E=z.max_count}z.count=E;z.multi=false;return g.Multi(F,z,K)}}var G=z.onselect;z.onselect=function(W,S,V,T,U){if(U){K[W+S+V]=this}else{K[W+S+V]=null}Q(G)};Q(G);z.remain=true;z.date=h(z.date[0]);if(!z.date){z.date=new Date()}}else{z.date=h(z.date);if(!z.date){z.date=new Date()}K[q(z.date,"yyyyMMdd")]=z.date;if(!z.onselect){z.onselect=function(X,W,V,U,S,T){F.value=z.format?q(this,z.format):(X+"-"+W+"-"+V+(z.show_time===true?(" "+U+":"+S+":"+T):""))}}var x=[z.date.getFullYear(),r(z.date.getMonth()+1),r(z.date.getDate())];if(z.show_time===true){x.push(r(z.date.getHours()),r(z.date.getMinutes()),r(z.date.getSeconds()))}x.push(_index);z.onselect.apply(z.date,x)}if(R=="input"){k(document,"click",function(T){if(!J||!J.main){return}var S=(T.target||event.srcElement);if(F==S||J.main==S||e(S,J.main)){return}J.main.style.display="none"});k(F,"focus",function(S){l(J,F)});J=m(null,z,M,P);J.main.style.display="none"}else{if(R=="div"){z.remain=true;J=m(F,z,M,P)}else{k(document,"click",function(T){if(!J||!J.main){return}var S=(T.target||event.srcElement);if(J.main==S||e(S,J.main)){return}J.main.style.display="none"});k(F,"click",function(S){i(S);l(J,F)});J=m(null,z,M,P);J.main.style.display="none"}}f++;if(z.multi_select===true){k(J.weeks,"click",function(W){var X=(W?W.target:event.srcElement)||document,V=-1,T=X.className;if(T&&T.indexOf("weeks")>=0){var Z=J.weeks.getElementsByTagName("li"),Y,aa,S;for(var U=0;U<Z.length;U++){if(X==Z[U]){V=U}else{if(V>=0&&U%7==V){Y=new Date(p(J.year,true),Z[U].month-1,Z[U].day);S=q(Y,"yyyyMMdd");if(K[S]){K[S]=null}else{K[S]=Y}if(Z[U].isInMonth){aa=Y}}}}if(aa){H(aa)}Q(G);if(T=="weeks"){X.className="weeks checked"}else{X.className="weeks"}}})}if(z.set_up_date){z.date=h(z.set_up_date)||z.date}H(z.date);if(z.show_time===true){J.time.hours(z.date.getHours());J.time.minutes(z.date.getMinutes());J.time.seconds(z.date.getSeconds())}return{options:z,controls:J,date_up:H}};g.format=q;g.Multi=function(x,A,B){function C(){var J=w("div",null,null,"calendar-group inline-block"),L,H,G;G=w("div",null,J,"calendar-arraw calendar-arraw-up",'<div class="b"></div><div class="a"></div>');for(var I=0;I<F.count;I++){if(F.set_up_months){L=F.set_up_months[I]}g(J,n(F,{set_up_date:L||new Date(),has_container:true}),B)}if(F.show_close!==false){var K=w("div",null,J,"calendar-close","x");K.onclick=function(){J.style.display="none"}}H=w("div",null,J,"calendar-arraw calendar-arraw-down",'<div class="b"></div><div class="a"></div>');return{main:J,arraw_up:G,arraw_down:H}}var F={date:[],onselect:null,count:2},D=null,y=[];for(var z in A){if(!A.hasOwnProperty(z)){continue}F[z]=A[z]}F.remain=true;F.lines=6;if(!F.onselect){F.onselect=function(G){x.value=G.join(",")}}"string"==typeof(x)&&(x=document.getElementById(x));if(!x){if(F.onerror){F.onerror("target element error.")}return}var E=x.tagName.toLowerCase();if(E=="input"){if(x.type!="text"){if(F.onerror){F.onerror("target element error.")}return}k(document,"click",function(H){if(!D||!D.main){return}var G=(H.target||event.srcElement);if(x==G||D.main==G||e(G,D.main)){return}D.main.style.display="none"});k(x,"focus",function(G){l(D,x)});D=C();D.main.style.display="none"}else{if(E=="div"){D=C();x.appendChild(D.main)}else{k(document,"click",function(H){if(!D||!D.main){return}var G=(H.target||event.srcElement);if(D.main==G||e(G,D.main)){return}D.main.style.display="none"});k(x,"click",function(G){i(G);l(D,x)});D=C();D.main.style.display="none"}}return{options:F,controls:D}}})();